{"ast":null,"code":"import _toConsumableArray from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{createContext,useContext,useReducer,useMemo,useCallback,useState,useEffect}from'react';import{timeframeOptions,SUPPORTED_LIST_URLS__NO_ENS}from'../constants';import dayjs from'dayjs';import utc from'dayjs/plugin/utc';import getTokenList from'../utils/tokenLists';import{healthClient}from'../apollo/client';import{SUBGRAPH_HEALTH}from'../apollo/queries';dayjs.extend(utc);var UPDATE='UPDATE';var UPDATE_TIMEFRAME='UPDATE_TIMEFRAME';var UPDATE_SESSION_START='UPDATE_SESSION_START';var UPDATED_SUPPORTED_TOKENS='UPDATED_SUPPORTED_TOKENS';var UPDATE_LATEST_BLOCK='UPDATE_LATEST_BLOCK';var UPDATE_HEAD_BLOCK='UPDATE_HEAD_BLOCK';var SUPPORTED_TOKENS='SUPPORTED_TOKENS';var TIME_KEY='TIME_KEY';var CURRENCY='CURRENCY';var SESSION_START='SESSION_START';var LATEST_BLOCK='LATEST_BLOCK';var HEAD_BLOCK='HEAD_BLOCK';var ApplicationContext=createContext();function useApplicationContext(){return useContext(ApplicationContext);}function reducer(state,_ref){var type=_ref.type,payload=_ref.payload;switch(type){case UPDATE:{var currency=payload.currency;return _objectSpread(_objectSpread({},state),{},_defineProperty({},CURRENCY,currency));}case UPDATE_TIMEFRAME:{var newTimeFrame=payload.newTimeFrame;return _objectSpread(_objectSpread({},state),{},_defineProperty({},TIME_KEY,newTimeFrame));}case UPDATE_SESSION_START:{var timestamp=payload.timestamp;return _objectSpread(_objectSpread({},state),{},_defineProperty({},SESSION_START,timestamp));}case UPDATE_LATEST_BLOCK:{var block=payload.block;return _objectSpread(_objectSpread({},state),{},_defineProperty({},LATEST_BLOCK,block));}case UPDATE_HEAD_BLOCK:{var _block=payload.block;return _objectSpread(_objectSpread({},state),{},_defineProperty({},HEAD_BLOCK,_block));}case UPDATED_SUPPORTED_TOKENS:{var supportedTokens=payload.supportedTokens;return _objectSpread(_objectSpread({},state),{},_defineProperty({},SUPPORTED_TOKENS,supportedTokens));}default:{throw Error(\"Unexpected action type in DataContext reducer: '\".concat(type,\"'.\"));}}}var INITIAL_STATE={CURRENCY:'USD',TIME_KEY:timeframeOptions.ALL_TIME};export default function Provider(_ref2){var children=_ref2.children;var _useReducer=useReducer(reducer,INITIAL_STATE),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var update=useCallback(function(currency){dispatch({type:UPDATE,payload:{currency:currency}});},[]);// global time window for charts - see timeframe options in constants\nvar updateTimeframe=useCallback(function(newTimeFrame){dispatch({type:UPDATE_TIMEFRAME,payload:{newTimeFrame:newTimeFrame}});},[]);// used for refresh button\nvar updateSessionStart=useCallback(function(timestamp){dispatch({type:UPDATE_SESSION_START,payload:{timestamp:timestamp}});},[]);var updateSupportedTokens=useCallback(function(supportedTokens){dispatch({type:UPDATED_SUPPORTED_TOKENS,payload:{supportedTokens:supportedTokens}});},[]);var updateLatestBlock=useCallback(function(block){dispatch({type:UPDATE_LATEST_BLOCK,payload:{block:block}});},[]);var updateHeadBlock=useCallback(function(block){dispatch({type:UPDATE_HEAD_BLOCK,payload:{block:block}});},[]);return/*#__PURE__*/React.createElement(ApplicationContext.Provider,{value:useMemo(function(){return[state,{update:update,updateSessionStart:updateSessionStart,updateTimeframe:updateTimeframe,updateSupportedTokens:updateSupportedTokens,updateLatestBlock:updateLatestBlock,updateHeadBlock:updateHeadBlock}];},[state,update,updateTimeframe,updateSessionStart,updateSupportedTokens,updateLatestBlock,updateHeadBlock])},children);}export function useLatestBlocks(){var _useApplicationContex=useApplicationContext(),_useApplicationContex2=_slicedToArray(_useApplicationContex,2),state=_useApplicationContex2[0],_useApplicationContex3=_useApplicationContex2[1],updateLatestBlock=_useApplicationContex3.updateLatestBlock,updateHeadBlock=_useApplicationContex3.updateHeadBlock;var latestBlock=state===null||state===void 0?void 0:state[LATEST_BLOCK];var headBlock=state===null||state===void 0?void 0:state[HEAD_BLOCK];useEffect(function(){function fetch(){return _fetch.apply(this,arguments);}function _fetch(){_fetch=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:healthClient.query({query:SUBGRAPH_HEALTH}).then(function(res){var syncedBlock=res.data.indexingStatusForCurrentVersion.chains[0].latestBlock.number;var headBlock=res.data.indexingStatusForCurrentVersion.chains[0].chainHeadBlock.number;if(syncedBlock&&headBlock){updateLatestBlock(syncedBlock);updateHeadBlock(headBlock);}}).catch(function(e){console.log(e);});case 1:case\"end\":return _context.stop();}}},_callee);}));return _fetch.apply(this,arguments);}if(!latestBlock){fetch();}},[latestBlock,updateHeadBlock,updateLatestBlock]);return[latestBlock,headBlock];}export function useCurrentCurrency(){var _useApplicationContex4=useApplicationContext(),_useApplicationContex5=_slicedToArray(_useApplicationContex4,2),state=_useApplicationContex5[0],update=_useApplicationContex5[1].update;var toggleCurrency=useCallback(function(){if(state.currency==='ETH'){update('USD');}else{update('ETH');}},[state,update]);return[state[CURRENCY],toggleCurrency];}export function useTimeframe(){var _useApplicationContex6=useApplicationContext(),_useApplicationContex7=_slicedToArray(_useApplicationContex6,2),state=_useApplicationContex7[0],updateTimeframe=_useApplicationContex7[1].updateTimeframe;var activeTimeframe=state===null||state===void 0?void 0:state[TIME_KEY];return[activeTimeframe,updateTimeframe];}export function useStartTimestamp(){var _useTimeframe=useTimeframe(),_useTimeframe2=_slicedToArray(_useTimeframe,1),activeWindow=_useTimeframe2[0];var _useState=useState(),_useState2=_slicedToArray(_useState,2),startDateTimestamp=_useState2[0],setStartDateTimestamp=_useState2[1];// monitor the old date fetched\nuseEffect(function(){var startTime=dayjs.utc().subtract(1,activeWindow===timeframeOptions.week?'week':activeWindow===timeframeOptions.ALL_TIME?'year':'year').startOf('day').unix()-1;// if we find a new start time less than the current startrtime - update oldest pooint to fetch\nsetStartDateTimestamp(startTime);},[activeWindow,startDateTimestamp]);return startDateTimestamp;}// keep track of session length for refresh ticker\nexport function useSessionStart(){var _useApplicationContex8=useApplicationContext(),_useApplicationContex9=_slicedToArray(_useApplicationContex8,2),state=_useApplicationContex9[0],updateSessionStart=_useApplicationContex9[1].updateSessionStart;var sessionStart=state===null||state===void 0?void 0:state[SESSION_START];useEffect(function(){if(!sessionStart){updateSessionStart(Date.now());}});var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),seconds=_useState4[0],setSeconds=_useState4[1];useEffect(function(){var interval=null;interval=setInterval(function(){var _ref3;setSeconds((_ref3=Date.now()-sessionStart)!==null&&_ref3!==void 0?_ref3:Date.now());},1000);return function(){return clearInterval(interval);};},[seconds,sessionStart]);return parseInt(seconds/1000);}export function useListedTokens(){var _useApplicationContex10=useApplicationContext(),_useApplicationContex11=_slicedToArray(_useApplicationContex10,2),state=_useApplicationContex11[0],updateSupportedTokens=_useApplicationContex11[1].updateSupportedTokens;var supportedTokens=state===null||state===void 0?void 0:state[SUPPORTED_TOKENS];useEffect(function(){function fetchList(){return _fetchList.apply(this,arguments);}function _fetchList(){_fetchList=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var allFetched,formatted;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return SUPPORTED_LIST_URLS__NO_ENS.reduce(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(fetchedTokens,url){var tokensSoFar,newTokens;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetchedTokens;case 2:tokensSoFar=_context2.sent;_context2.next=5;return getTokenList(url);case 5:newTokens=_context2.sent;return _context2.abrupt(\"return\",Promise.resolve([].concat(_toConsumableArray(tokensSoFar),_toConsumableArray(newTokens.tokens))));case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x,_x2){return _ref4.apply(this,arguments);};}(),Promise.resolve([]));case 2:allFetched=_context3.sent;formatted=allFetched===null||allFetched===void 0?void 0:allFetched.map(function(t){return t.address.toLowerCase();});updateSupportedTokens(formatted);case 5:case\"end\":return _context3.stop();}}},_callee3);}));return _fetchList.apply(this,arguments);}if(!supportedTokens){fetchList();}},[updateSupportedTokens,supportedTokens]);return supportedTokens;}","map":{"version":3,"sources":["/Users/macbook/Desktop/juiceswap/juiceswap-docs/src/contexts/Application.js"],"names":["React","createContext","useContext","useReducer","useMemo","useCallback","useState","useEffect","timeframeOptions","SUPPORTED_LIST_URLS__NO_ENS","dayjs","utc","getTokenList","healthClient","SUBGRAPH_HEALTH","extend","UPDATE","UPDATE_TIMEFRAME","UPDATE_SESSION_START","UPDATED_SUPPORTED_TOKENS","UPDATE_LATEST_BLOCK","UPDATE_HEAD_BLOCK","SUPPORTED_TOKENS","TIME_KEY","CURRENCY","SESSION_START","LATEST_BLOCK","HEAD_BLOCK","ApplicationContext","useApplicationContext","reducer","state","type","payload","currency","newTimeFrame","timestamp","block","supportedTokens","Error","INITIAL_STATE","ALL_TIME","Provider","children","dispatch","update","updateTimeframe","updateSessionStart","updateSupportedTokens","updateLatestBlock","updateHeadBlock","useLatestBlocks","latestBlock","headBlock","fetch","query","then","res","syncedBlock","data","indexingStatusForCurrentVersion","chains","number","chainHeadBlock","catch","e","console","log","useCurrentCurrency","toggleCurrency","useTimeframe","activeTimeframe","useStartTimestamp","activeWindow","startDateTimestamp","setStartDateTimestamp","startTime","subtract","week","startOf","unix","useSessionStart","sessionStart","Date","now","seconds","setSeconds","interval","setInterval","clearInterval","parseInt","useListedTokens","fetchList","reduce","fetchedTokens","url","tokensSoFar","newTokens","Promise","resolve","tokens","allFetched","formatted","map","t","address","toLowerCase"],"mappings":"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","sourcesContent":["import React, { createContext, useContext, useReducer, useMemo, useCallback, useState, useEffect } from 'react'\nimport { timeframeOptions, SUPPORTED_LIST_URLS__NO_ENS } from '../constants'\nimport dayjs from 'dayjs'\nimport utc from 'dayjs/plugin/utc'\nimport getTokenList from '../utils/tokenLists'\nimport { healthClient } from '../apollo/client'\nimport { SUBGRAPH_HEALTH } from '../apollo/queries'\ndayjs.extend(utc)\n\nconst UPDATE = 'UPDATE'\nconst UPDATE_TIMEFRAME = 'UPDATE_TIMEFRAME'\nconst UPDATE_SESSION_START = 'UPDATE_SESSION_START'\nconst UPDATED_SUPPORTED_TOKENS = 'UPDATED_SUPPORTED_TOKENS'\nconst UPDATE_LATEST_BLOCK = 'UPDATE_LATEST_BLOCK'\nconst UPDATE_HEAD_BLOCK = 'UPDATE_HEAD_BLOCK'\n\nconst SUPPORTED_TOKENS = 'SUPPORTED_TOKENS'\nconst TIME_KEY = 'TIME_KEY'\nconst CURRENCY = 'CURRENCY'\nconst SESSION_START = 'SESSION_START'\nconst LATEST_BLOCK = 'LATEST_BLOCK'\nconst HEAD_BLOCK = 'HEAD_BLOCK'\n\nconst ApplicationContext = createContext()\n\nfunction useApplicationContext() {\n  return useContext(ApplicationContext)\n}\n\nfunction reducer(state, { type, payload }) {\n  switch (type) {\n    case UPDATE: {\n      const { currency } = payload\n      return {\n        ...state,\n        [CURRENCY]: currency,\n      }\n    }\n    case UPDATE_TIMEFRAME: {\n      const { newTimeFrame } = payload\n      return {\n        ...state,\n        [TIME_KEY]: newTimeFrame,\n      }\n    }\n    case UPDATE_SESSION_START: {\n      const { timestamp } = payload\n      return {\n        ...state,\n        [SESSION_START]: timestamp,\n      }\n    }\n\n    case UPDATE_LATEST_BLOCK: {\n      const { block } = payload\n      return {\n        ...state,\n        [LATEST_BLOCK]: block,\n      }\n    }\n\n    case UPDATE_HEAD_BLOCK: {\n      const { block } = payload\n      return {\n        ...state,\n        [HEAD_BLOCK]: block,\n      }\n    }\n\n    case UPDATED_SUPPORTED_TOKENS: {\n      const { supportedTokens } = payload\n      return {\n        ...state,\n        [SUPPORTED_TOKENS]: supportedTokens,\n      }\n    }\n\n    default: {\n      throw Error(`Unexpected action type in DataContext reducer: '${type}'.`)\n    }\n  }\n}\n\nconst INITIAL_STATE = {\n  CURRENCY: 'USD',\n  TIME_KEY: timeframeOptions.ALL_TIME,\n}\n\nexport default function Provider({ children }) {\n  const [state, dispatch] = useReducer(reducer, INITIAL_STATE)\n  const update = useCallback((currency) => {\n    dispatch({\n      type: UPDATE,\n      payload: {\n        currency,\n      },\n    })\n  }, [])\n\n  // global time window for charts - see timeframe options in constants\n  const updateTimeframe = useCallback((newTimeFrame) => {\n    dispatch({\n      type: UPDATE_TIMEFRAME,\n      payload: {\n        newTimeFrame,\n      },\n    })\n  }, [])\n\n  // used for refresh button\n  const updateSessionStart = useCallback((timestamp) => {\n    dispatch({\n      type: UPDATE_SESSION_START,\n      payload: {\n        timestamp,\n      },\n    })\n  }, [])\n\n  const updateSupportedTokens = useCallback((supportedTokens) => {\n    dispatch({\n      type: UPDATED_SUPPORTED_TOKENS,\n      payload: {\n        supportedTokens,\n      },\n    })\n  }, [])\n\n  const updateLatestBlock = useCallback((block) => {\n    dispatch({\n      type: UPDATE_LATEST_BLOCK,\n      payload: {\n        block,\n      },\n    })\n  }, [])\n\n  const updateHeadBlock = useCallback((block) => {\n    dispatch({\n      type: UPDATE_HEAD_BLOCK,\n      payload: {\n        block,\n      },\n    })\n  }, [])\n\n  return (\n    <ApplicationContext.Provider\n      value={useMemo(\n        () => [\n          state,\n          {\n            update,\n            updateSessionStart,\n            updateTimeframe,\n            updateSupportedTokens,\n            updateLatestBlock,\n            updateHeadBlock,\n          },\n        ],\n        [state, update, updateTimeframe, updateSessionStart, updateSupportedTokens, updateLatestBlock, updateHeadBlock]\n      )}\n    >\n      {children}\n    </ApplicationContext.Provider>\n  )\n}\n\nexport function useLatestBlocks() {\n  const [state, { updateLatestBlock, updateHeadBlock }] = useApplicationContext()\n\n  const latestBlock = state?.[LATEST_BLOCK]\n  const headBlock = state?.[HEAD_BLOCK]\n\n  useEffect(() => {\n    async function fetch() {\n      healthClient\n        .query({\n          query: SUBGRAPH_HEALTH,\n        })\n        .then((res) => {\n          const syncedBlock = res.data.indexingStatusForCurrentVersion.chains[0].latestBlock.number\n          const headBlock = res.data.indexingStatusForCurrentVersion.chains[0].chainHeadBlock.number\n          if (syncedBlock && headBlock) {\n            updateLatestBlock(syncedBlock)\n            updateHeadBlock(headBlock)\n          }\n        })\n        .catch((e) => {\n          console.log(e)\n        })\n    }\n    if (!latestBlock) {\n      fetch()\n    }\n  }, [latestBlock, updateHeadBlock, updateLatestBlock])\n\n  return [latestBlock, headBlock]\n}\n\nexport function useCurrentCurrency() {\n  const [state, { update }] = useApplicationContext()\n  const toggleCurrency = useCallback(() => {\n    if (state.currency === 'ETH') {\n      update('USD')\n    } else {\n      update('ETH')\n    }\n  }, [state, update])\n  return [state[CURRENCY], toggleCurrency]\n}\n\nexport function useTimeframe() {\n  const [state, { updateTimeframe }] = useApplicationContext()\n  const activeTimeframe = state?.[TIME_KEY]\n  return [activeTimeframe, updateTimeframe]\n}\n\nexport function useStartTimestamp() {\n  const [activeWindow] = useTimeframe()\n  const [startDateTimestamp, setStartDateTimestamp] = useState()\n\n  // monitor the old date fetched\n  useEffect(() => {\n    let startTime =\n      dayjs\n        .utc()\n        .subtract(\n          1,\n          activeWindow === timeframeOptions.week ? 'week' : activeWindow === timeframeOptions.ALL_TIME ? 'year' : 'year'\n        )\n        .startOf('day')\n        .unix() - 1\n    // if we find a new start time less than the current startrtime - update oldest pooint to fetch\n    setStartDateTimestamp(startTime)\n  }, [activeWindow, startDateTimestamp])\n\n  return startDateTimestamp\n}\n\n// keep track of session length for refresh ticker\nexport function useSessionStart() {\n  const [state, { updateSessionStart }] = useApplicationContext()\n  const sessionStart = state?.[SESSION_START]\n\n  useEffect(() => {\n    if (!sessionStart) {\n      updateSessionStart(Date.now())\n    }\n  })\n\n  const [seconds, setSeconds] = useState(0)\n\n  useEffect(() => {\n    let interval = null\n    interval = setInterval(() => {\n      setSeconds(Date.now() - sessionStart ?? Date.now())\n    }, 1000)\n\n    return () => clearInterval(interval)\n  }, [seconds, sessionStart])\n\n  return parseInt(seconds / 1000)\n}\n\nexport function useListedTokens() {\n  const [state, { updateSupportedTokens }] = useApplicationContext()\n  const supportedTokens = state?.[SUPPORTED_TOKENS]\n\n  useEffect(() => {\n    async function fetchList() {\n      const allFetched = await SUPPORTED_LIST_URLS__NO_ENS.reduce(async (fetchedTokens, url) => {\n        const tokensSoFar = await fetchedTokens\n        const newTokens = await getTokenList(url)\n        return Promise.resolve([...tokensSoFar, ...newTokens.tokens])\n      }, Promise.resolve([]))\n      let formatted = allFetched?.map((t) => t.address.toLowerCase())\n      updateSupportedTokens(formatted)\n    }\n    if (!supportedTokens) {\n      fetchList()\n    }\n  }, [updateSupportedTokens, supportedTokens])\n\n  return supportedTokens\n}\n"]},"metadata":{},"sourceType":"module"}