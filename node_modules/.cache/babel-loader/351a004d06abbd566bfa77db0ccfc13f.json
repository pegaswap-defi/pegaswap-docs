{"ast":null,"code":"import _regeneratorRuntime from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{createContext,useContext,useReducer,useMemo,useCallback,useEffect}from'react';import{client}from'../apollo/client';import{TOKEN_DATA,FILTERED_TRANSACTIONS,TOKEN_CHART,TOKENS_CURRENT,TOKENS_DYNAMIC,PRICES_BY_BLOCK,PAIR_DATA}from'../apollo/queries';import{useEthPrice}from'./GlobalData';import dayjs from'dayjs';import utc from'dayjs/plugin/utc';import{get2DayPercentChange,getPercentChange,getBlockFromTimestamp,isAddress,getBlocksFromTimestamps,splitQuery}from'../utils';import{timeframeOptions}from'../constants';import{useLatestBlocks}from'./Application';import{updateNameData}from'../utils/data';var UPDATE='UPDATE';var UPDATE_TOKEN_TXNS='UPDATE_TOKEN_TXNS';var UPDATE_CHART_DATA='UPDATE_CHART_DATA';var UPDATE_PRICE_DATA='UPDATE_PRICE_DATA';var UPDATE_TOP_TOKENS=' UPDATE_TOP_TOKENS';var UPDATE_ALL_PAIRS='UPDATE_ALL_PAIRS';var TOKEN_PAIRS_KEY='TOKEN_PAIRS_KEY';dayjs.extend(utc);var TokenDataContext=createContext();function useTokenDataContext(){return useContext(TokenDataContext);}function reducer(state,_ref){var type=_ref.type,payload=_ref.payload;switch(type){case UPDATE:{var tokenAddress=payload.tokenAddress,data=payload.data;return _objectSpread(_objectSpread({},state),{},_defineProperty({},tokenAddress,_objectSpread(_objectSpread({},state===null||state===void 0?void 0:state[tokenAddress]),data)));}case UPDATE_TOP_TOKENS:{var topTokens=payload.topTokens;var added={};topTokens&&topTokens.map(function(token){return added[token.id]=token;});return _objectSpread(_objectSpread({},state),added);}case UPDATE_TOKEN_TXNS:{var address=payload.address,transactions=payload.transactions;return _objectSpread(_objectSpread({},state),{},_defineProperty({},address,_objectSpread(_objectSpread({},state===null||state===void 0?void 0:state[address]),{},{txns:transactions})));}case UPDATE_CHART_DATA:{var _address=payload.address,chartData=payload.chartData;return _objectSpread(_objectSpread({},state),{},_defineProperty({},_address,_objectSpread(_objectSpread({},state===null||state===void 0?void 0:state[_address]),{},{chartData:chartData})));}case UPDATE_PRICE_DATA:{var _state$_address;var _address2=payload.address,_data=payload.data,timeWindow=payload.timeWindow,interval=payload.interval;return _objectSpread(_objectSpread({},state),{},_defineProperty({},_address2,_objectSpread(_objectSpread({},state===null||state===void 0?void 0:state[_address2]),{},_defineProperty({},timeWindow,_objectSpread(_objectSpread({},state===null||state===void 0?void 0:(_state$_address=state[_address2])===null||_state$_address===void 0?void 0:_state$_address[timeWindow]),{},_defineProperty({},interval,_data))))));}case UPDATE_ALL_PAIRS:{var _address3=payload.address,allPairs=payload.allPairs;return _objectSpread(_objectSpread({},state),{},_defineProperty({},_address3,_objectSpread(_objectSpread({},state===null||state===void 0?void 0:state[_address3]),{},_defineProperty({},TOKEN_PAIRS_KEY,allPairs))));}default:{throw Error(\"Unexpected action type in DataContext reducer: '\".concat(type,\"'.\"));}}}export default function Provider(_ref2){var children=_ref2.children;var _useReducer=useReducer(reducer,{}),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var update=useCallback(function(tokenAddress,data){dispatch({type:UPDATE,payload:{tokenAddress:tokenAddress,data:data}});},[]);var updateTopTokens=useCallback(function(topTokens){dispatch({type:UPDATE_TOP_TOKENS,payload:{topTokens:topTokens}});},[]);var updateTokenTxns=useCallback(function(address,transactions){dispatch({type:UPDATE_TOKEN_TXNS,payload:{address:address,transactions:transactions}});},[]);var updateChartData=useCallback(function(address,chartData){dispatch({type:UPDATE_CHART_DATA,payload:{address:address,chartData:chartData}});},[]);var updateAllPairs=useCallback(function(address,allPairs){dispatch({type:UPDATE_ALL_PAIRS,payload:{address:address,allPairs:allPairs}});},[]);var updatePriceData=useCallback(function(address,data,timeWindow,interval){dispatch({type:UPDATE_PRICE_DATA,payload:{address:address,data:data,timeWindow:timeWindow,interval:interval}});},[]);return/*#__PURE__*/React.createElement(TokenDataContext.Provider,{value:useMemo(function(){return[state,{update:update,updateTokenTxns:updateTokenTxns,updateChartData:updateChartData,updateTopTokens:updateTopTokens,updateAllPairs:updateAllPairs,updatePriceData:updatePriceData}];},[state,update,updateTokenTxns,updateChartData,updateTopTokens,updateAllPairs,updatePriceData])},children);}var getTopTokens=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(ethPrice,ethPriceOld){var utcCurrentTime,utcOneDayBack,utcTwoDaysBack,oneDayBlock,twoDayBlock,_oneDayResult$data,_twoDayResult$data,_current$data,current,oneDayResult,twoDayResult,oneDayData,twoDayData,bulkResults;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:utcCurrentTime=dayjs();utcOneDayBack=utcCurrentTime.subtract(1,'day').unix();utcTwoDaysBack=utcCurrentTime.subtract(2,'day').unix();_context2.next=5;return getBlockFromTimestamp(utcOneDayBack);case 5:oneDayBlock=_context2.sent;_context2.next=8;return getBlockFromTimestamp(utcTwoDaysBack);case 8:twoDayBlock=_context2.sent;_context2.prev=9;_context2.next=12;return client.query({query:TOKENS_CURRENT,fetchPolicy:'cache-first'});case 12:current=_context2.sent;_context2.next=15;return client.query({query:TOKENS_DYNAMIC(oneDayBlock),fetchPolicy:'cache-first'});case 15:oneDayResult=_context2.sent;_context2.next=18;return client.query({query:TOKENS_DYNAMIC(twoDayBlock),fetchPolicy:'cache-first'});case 18:twoDayResult=_context2.sent;oneDayData=oneDayResult===null||oneDayResult===void 0?void 0:(_oneDayResult$data=oneDayResult.data)===null||_oneDayResult$data===void 0?void 0:_oneDayResult$data.tokens.reduce(function(obj,cur,i){return _objectSpread(_objectSpread({},obj),{},_defineProperty({},cur.id,cur));},{});twoDayData=twoDayResult===null||twoDayResult===void 0?void 0:(_twoDayResult$data=twoDayResult.data)===null||_twoDayResult$data===void 0?void 0:_twoDayResult$data.tokens.reduce(function(obj,cur,i){return _objectSpread(_objectSpread({},obj),{},_defineProperty({},cur.id,cur));},{});_context2.next=23;return Promise.all(current&&oneDayData&&twoDayData&&(current===null||current===void 0?void 0:(_current$data=current.data)===null||_current$data===void 0?void 0:_current$data.tokens.map(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(token){var _oneDayHistory$tradeV,_oneDayHistory,_twoDayHistory$tradeV,_twoDayHistory,_oneDayHistory$txCoun,_oneDayHistory2,_twoDayHistory$txCoun,_twoDayHistory2,_oneDayHistory3,_oneDayHistory4,_oneDayHistory5,_oneDayHistory6;var data,oneDayHistory,twoDayHistory,_oneDayResult,_twoDayResult,_get2DayPercentChange,_get2DayPercentChange2,oneDayVolumeUSD,volumeChangeUSD,_get2DayPercentChange3,_get2DayPercentChange4,oneDayTxns,txnChange,currentLiquidityUSD,oldLiquidityUSD,priceChangeUSD,aaveData,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:data=token;// let liquidityDataThisToken = liquidityData?.[token.id]\noneDayHistory=oneDayData===null||oneDayData===void 0?void 0:oneDayData[token.id];twoDayHistory=twoDayData===null||twoDayData===void 0?void 0:twoDayData[token.id];// catch the case where token wasnt in top list in previous days\nif(oneDayHistory){_context.next=8;break;}_context.next=6;return client.query({query:TOKEN_DATA(token.id,oneDayBlock),fetchPolicy:'cache-first'});case 6:_oneDayResult=_context.sent;oneDayHistory=_oneDayResult.data.tokens[0];case 8:if(twoDayHistory){_context.next=13;break;}_context.next=11;return client.query({query:TOKEN_DATA(token.id,twoDayBlock),fetchPolicy:'cache-first'});case 11:_twoDayResult=_context.sent;twoDayHistory=_twoDayResult.data.tokens[0];case 13:// calculate percentage changes and daily changes\n_get2DayPercentChange=get2DayPercentChange(data.tradeVolumeUSD,(_oneDayHistory$tradeV=(_oneDayHistory=oneDayHistory)===null||_oneDayHistory===void 0?void 0:_oneDayHistory.tradeVolumeUSD)!==null&&_oneDayHistory$tradeV!==void 0?_oneDayHistory$tradeV:0,(_twoDayHistory$tradeV=(_twoDayHistory=twoDayHistory)===null||_twoDayHistory===void 0?void 0:_twoDayHistory.tradeVolumeUSD)!==null&&_twoDayHistory$tradeV!==void 0?_twoDayHistory$tradeV:0),_get2DayPercentChange2=_slicedToArray(_get2DayPercentChange,2),oneDayVolumeUSD=_get2DayPercentChange2[0],volumeChangeUSD=_get2DayPercentChange2[1];_get2DayPercentChange3=get2DayPercentChange(data.txCount,(_oneDayHistory$txCoun=(_oneDayHistory2=oneDayHistory)===null||_oneDayHistory2===void 0?void 0:_oneDayHistory2.txCount)!==null&&_oneDayHistory$txCoun!==void 0?_oneDayHistory$txCoun:0,(_twoDayHistory$txCoun=(_twoDayHistory2=twoDayHistory)===null||_twoDayHistory2===void 0?void 0:_twoDayHistory2.txCount)!==null&&_twoDayHistory$txCoun!==void 0?_twoDayHistory$txCoun:0),_get2DayPercentChange4=_slicedToArray(_get2DayPercentChange3,2),oneDayTxns=_get2DayPercentChange4[0],txnChange=_get2DayPercentChange4[1];currentLiquidityUSD=(data===null||data===void 0?void 0:data.totalLiquidity)*ethPrice*(data===null||data===void 0?void 0:data.derivedETH);oldLiquidityUSD=((_oneDayHistory3=oneDayHistory)===null||_oneDayHistory3===void 0?void 0:_oneDayHistory3.totalLiquidity)*ethPriceOld*((_oneDayHistory4=oneDayHistory)===null||_oneDayHistory4===void 0?void 0:_oneDayHistory4.derivedETH);// percent changes\npriceChangeUSD=getPercentChange((data===null||data===void 0?void 0:data.derivedETH)*ethPrice,((_oneDayHistory5=oneDayHistory)===null||_oneDayHistory5===void 0?void 0:_oneDayHistory5.derivedETH)?((_oneDayHistory6=oneDayHistory)===null||_oneDayHistory6===void 0?void 0:_oneDayHistory6.derivedETH)*ethPriceOld:0);// set data\ndata.priceUSD=(data===null||data===void 0?void 0:data.derivedETH)*ethPrice;data.totalLiquidityUSD=currentLiquidityUSD;data.oneDayVolumeUSD=parseFloat(oneDayVolumeUSD);data.volumeChangeUSD=volumeChangeUSD;data.priceChangeUSD=priceChangeUSD;data.liquidityChangeUSD=getPercentChange(currentLiquidityUSD!==null&&currentLiquidityUSD!==void 0?currentLiquidityUSD:0,oldLiquidityUSD!==null&&oldLiquidityUSD!==void 0?oldLiquidityUSD:0);data.oneDayTxns=oneDayTxns;data.txnChange=txnChange;// new tokens\nif(!oneDayHistory&&data){data.oneDayVolumeUSD=data.tradeVolumeUSD;data.oneDayVolumeETH=data.tradeVolume*data.derivedETH;data.oneDayTxns=data.txCount;}// update name data for\nupdateNameData({token0:data});// HOTFIX for Aave\nif(!(data.id==='0x7fc66500c84a76ad7e9c93437bfc5ac33e2ddae9')){_context.next=36;break;}_context.next=31;return client.query({query:PAIR_DATA('0xdfc14d2af169b0d36c4eff567ada9b2e0cae044f'),fetchPolicy:'cache-first'});case 31:aaveData=_context.sent;result=aaveData.data.pairs[0];data.totalLiquidityUSD=parseFloat(result.reserveUSD)/2;data.liquidityChangeUSD=0;data.priceChangeUSD=0;case 36:return _context.abrupt(\"return\",data);case 37:case\"end\":return _context.stop();}}},_callee);}));return function(_x3){return _ref4.apply(this,arguments);};}())));case 23:bulkResults=_context2.sent;return _context2.abrupt(\"return\",bulkResults);case 27:_context2.prev=27;_context2.t0=_context2[\"catch\"](9);console.log(_context2.t0);case 30:case\"end\":return _context2.stop();}}},_callee2,null,[[9,27]]);}));return function getTopTokens(_x,_x2){return _ref3.apply(this,arguments);};}();var getTokenData=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(address,ethPrice,ethPriceOld){var utcCurrentTime,utcOneDayBack,utcTwoDaysBack,oneDayBlock,twoDayBlock,data,oneDayData,twoDayData,_result$data,_result$data$tokens,_oneDayData$tradeVolu,_oneDayData,_twoDayData$tradeVolu,_twoDayData,_oneDayData$untracked,_oneDayData2,_twoDayData$untracked,_twoDayData2,_oneDayData$txCount,_oneDayData3,_twoDayData$txCount,_twoDayData3,_data2,_oneDayData$derivedET,_oneDayData4,_data3,_data4,_oneDayData5,_oneDayData6,_data5,result,oneDayResult,twoDayResult,_oneDayResult2,_twoDayResult2,_get2DayPercentChange5,_get2DayPercentChange6,oneDayVolumeUSD,volumeChangeUSD,_get2DayPercentChange7,_get2DayPercentChange8,oneDayVolumeUT,volumeChangeUT,_get2DayPercentChange9,_get2DayPercentChange10,oneDayTxns,txnChange,priceChangeUSD,currentLiquidityUSD,oldLiquidityUSD,liquidityChangeUSD,aaveData,_result;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:utcCurrentTime=dayjs();utcOneDayBack=utcCurrentTime.subtract(1,'day').startOf('minute').unix();utcTwoDaysBack=utcCurrentTime.subtract(2,'day').startOf('minute').unix();_context3.next=5;return getBlockFromTimestamp(utcOneDayBack);case 5:oneDayBlock=_context3.sent;_context3.next=8;return getBlockFromTimestamp(utcTwoDaysBack);case 8:twoDayBlock=_context3.sent;// initialize data arrays\ndata={};oneDayData={};twoDayData={};_context3.prev=12;_context3.next=15;return client.query({query:TOKEN_DATA(address),fetchPolicy:'cache-first'});case 15:result=_context3.sent;data=result===null||result===void 0?void 0:(_result$data=result.data)===null||_result$data===void 0?void 0:(_result$data$tokens=_result$data.tokens)===null||_result$data$tokens===void 0?void 0:_result$data$tokens[0];// get results from 24 hours in past\n_context3.next=19;return client.query({query:TOKEN_DATA(address,oneDayBlock),fetchPolicy:'cache-first'});case 19:oneDayResult=_context3.sent;oneDayData=oneDayResult.data.tokens[0];// get results from 48 hours in past\n_context3.next=23;return client.query({query:TOKEN_DATA(address,twoDayBlock),fetchPolicy:'cache-first'});case 23:twoDayResult=_context3.sent;twoDayData=twoDayResult.data.tokens[0];// catch the case where token wasnt in top list in previous days\nif(oneDayData){_context3.next=30;break;}_context3.next=28;return client.query({query:TOKEN_DATA(address,oneDayBlock),fetchPolicy:'cache-first'});case 28:_oneDayResult2=_context3.sent;oneDayData=_oneDayResult2.data.tokens[0];case 30:if(twoDayData){_context3.next=35;break;}_context3.next=33;return client.query({query:TOKEN_DATA(address,twoDayBlock),fetchPolicy:'cache-first'});case 33:_twoDayResult2=_context3.sent;twoDayData=_twoDayResult2.data.tokens[0];case 35:// calculate percentage changes and daily changes\n_get2DayPercentChange5=get2DayPercentChange(data.tradeVolumeUSD,(_oneDayData$tradeVolu=(_oneDayData=oneDayData)===null||_oneDayData===void 0?void 0:_oneDayData.tradeVolumeUSD)!==null&&_oneDayData$tradeVolu!==void 0?_oneDayData$tradeVolu:0,(_twoDayData$tradeVolu=(_twoDayData=twoDayData)===null||_twoDayData===void 0?void 0:_twoDayData.tradeVolumeUSD)!==null&&_twoDayData$tradeVolu!==void 0?_twoDayData$tradeVolu:0),_get2DayPercentChange6=_slicedToArray(_get2DayPercentChange5,2),oneDayVolumeUSD=_get2DayPercentChange6[0],volumeChangeUSD=_get2DayPercentChange6[1];// calculate percentage changes and daily changes\n_get2DayPercentChange7=get2DayPercentChange(data.untrackedVolumeUSD,(_oneDayData$untracked=(_oneDayData2=oneDayData)===null||_oneDayData2===void 0?void 0:_oneDayData2.untrackedVolumeUSD)!==null&&_oneDayData$untracked!==void 0?_oneDayData$untracked:0,(_twoDayData$untracked=(_twoDayData2=twoDayData)===null||_twoDayData2===void 0?void 0:_twoDayData2.untrackedVolumeUSD)!==null&&_twoDayData$untracked!==void 0?_twoDayData$untracked:0),_get2DayPercentChange8=_slicedToArray(_get2DayPercentChange7,2),oneDayVolumeUT=_get2DayPercentChange8[0],volumeChangeUT=_get2DayPercentChange8[1];// calculate percentage changes and daily changes\n_get2DayPercentChange9=get2DayPercentChange(data.txCount,(_oneDayData$txCount=(_oneDayData3=oneDayData)===null||_oneDayData3===void 0?void 0:_oneDayData3.txCount)!==null&&_oneDayData$txCount!==void 0?_oneDayData$txCount:0,(_twoDayData$txCount=(_twoDayData3=twoDayData)===null||_twoDayData3===void 0?void 0:_twoDayData3.txCount)!==null&&_twoDayData$txCount!==void 0?_twoDayData$txCount:0),_get2DayPercentChange10=_slicedToArray(_get2DayPercentChange9,2),oneDayTxns=_get2DayPercentChange10[0],txnChange=_get2DayPercentChange10[1];priceChangeUSD=getPercentChange(((_data2=data)===null||_data2===void 0?void 0:_data2.derivedETH)*ethPrice,parseFloat((_oneDayData$derivedET=(_oneDayData4=oneDayData)===null||_oneDayData4===void 0?void 0:_oneDayData4.derivedETH)!==null&&_oneDayData$derivedET!==void 0?_oneDayData$derivedET:0)*ethPriceOld);currentLiquidityUSD=((_data3=data)===null||_data3===void 0?void 0:_data3.totalLiquidity)*ethPrice*((_data4=data)===null||_data4===void 0?void 0:_data4.derivedETH);oldLiquidityUSD=((_oneDayData5=oneDayData)===null||_oneDayData5===void 0?void 0:_oneDayData5.totalLiquidity)*ethPriceOld*((_oneDayData6=oneDayData)===null||_oneDayData6===void 0?void 0:_oneDayData6.derivedETH);// set data\ndata.priceUSD=((_data5=data)===null||_data5===void 0?void 0:_data5.derivedETH)*ethPrice;data.totalLiquidityUSD=currentLiquidityUSD;data.oneDayVolumeUSD=oneDayVolumeUSD;data.volumeChangeUSD=volumeChangeUSD;data.priceChangeUSD=priceChangeUSD;data.oneDayVolumeUT=oneDayVolumeUT;data.volumeChangeUT=volumeChangeUT;liquidityChangeUSD=getPercentChange(currentLiquidityUSD!==null&&currentLiquidityUSD!==void 0?currentLiquidityUSD:0,oldLiquidityUSD!==null&&oldLiquidityUSD!==void 0?oldLiquidityUSD:0);data.liquidityChangeUSD=liquidityChangeUSD;data.oneDayTxns=oneDayTxns;data.txnChange=txnChange;// new tokens\nif(!oneDayData&&data){data.oneDayVolumeUSD=data.tradeVolumeUSD;data.oneDayVolumeETH=data.tradeVolume*data.derivedETH;data.oneDayTxns=data.txCount;}// update name data for\nupdateNameData({token0:data});// HOTFIX for Aave\nif(!(data.id==='0x7fc66500c84a76ad7e9c93437bfc5ac33e2ddae9')){_context3.next=62;break;}_context3.next=57;return client.query({query:PAIR_DATA('0xdfc14d2af169b0d36c4eff567ada9b2e0cae044f'),fetchPolicy:'cache-first'});case 57:aaveData=_context3.sent;_result=aaveData.data.pairs[0];data.totalLiquidityUSD=parseFloat(_result.reserveUSD)/2;data.liquidityChangeUSD=0;data.priceChangeUSD=0;case 62:_context3.next=67;break;case 64:_context3.prev=64;_context3.t0=_context3[\"catch\"](12);console.log(_context3.t0);case 67:return _context3.abrupt(\"return\",data);case 68:case\"end\":return _context3.stop();}}},_callee3,null,[[12,64]]);}));return function getTokenData(_x4,_x5,_x6){return _ref5.apply(this,arguments);};}();var getTokenTransactions=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(allPairsFormatted){var transactions,result;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:transactions={};_context4.prev=1;_context4.next=4;return client.query({query:FILTERED_TRANSACTIONS,variables:{allPairs:allPairsFormatted},fetchPolicy:'cache-first'});case 4:result=_context4.sent;transactions.mints=result.data.mints;transactions.burns=result.data.burns;transactions.swaps=result.data.swaps;_context4.next=13;break;case 10:_context4.prev=10;_context4.t0=_context4[\"catch\"](1);console.log(_context4.t0);case 13:return _context4.abrupt(\"return\",transactions);case 14:case\"end\":return _context4.stop();}}},_callee4,null,[[1,10]]);}));return function getTokenTransactions(_x7){return _ref6.apply(this,arguments);};}();var getTokenPairs=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(tokenAddress){var _result$data2,_result$data3,result;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return client.query({query:TOKEN_DATA(tokenAddress),fetchPolicy:'cache-first'});case 3:result=_context5.sent;return _context5.abrupt(\"return\",(_result$data2=result.data)===null||_result$data2===void 0?void 0:_result$data2['pairs0'].concat((_result$data3=result.data)===null||_result$data3===void 0?void 0:_result$data3['pairs1']));case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](0);console.log(_context5.t0);case 10:case\"end\":return _context5.stop();}}},_callee5,null,[[0,7]]);}));return function getTokenPairs(_x8){return _ref7.apply(this,arguments);};}();var getIntervalTokenData=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(tokenAddress,startTime){var interval,latestBlock,utcEndTime,time,timestamps,blocks,result,values,row,_result$row,timestamp,derivedETH,index,brow,_timestamp,formattedHistory,i,_args6=arguments;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:interval=_args6.length>2&&_args6[2]!==undefined?_args6[2]:3600;latestBlock=_args6.length>3?_args6[3]:undefined;utcEndTime=dayjs.utc();time=startTime;// create an array of hour start times until we reach current hour\n// buffer by half hour to catch case where graph isnt synced to latest block\ntimestamps=[];while(time<utcEndTime.unix()){timestamps.push(time);time+=interval;}// backout if invalid timestamp format\nif(!(timestamps.length===0)){_context6.next=8;break;}return _context6.abrupt(\"return\",[]);case 8:_context6.prev=8;_context6.next=11;return getBlocksFromTimestamps(timestamps,100);case 11:blocks=_context6.sent;if(!(!blocks||blocks.length===0)){_context6.next=14;break;}return _context6.abrupt(\"return\",[]);case 14:if(latestBlock){blocks=blocks.filter(function(b){return parseFloat(b.number)<=parseFloat(latestBlock);});}_context6.next=17;return splitQuery(PRICES_BY_BLOCK,client,[tokenAddress],blocks,50);case 17:result=_context6.sent;// format token ETH price results\nvalues=[];for(row in result){timestamp=row.split('t')[1];derivedETH=parseFloat((_result$row=result[row])===null||_result$row===void 0?void 0:_result$row.derivedETH);if(timestamp){values.push({timestamp:timestamp,derivedETH:derivedETH});}}// go through eth usd prices and assign to original values array\nindex=0;for(brow in result){_timestamp=brow.split('b')[1];if(_timestamp){values[index].priceUSD=result[brow].ethPrice*values[index].derivedETH;index+=1;}}formattedHistory=[];// for each hour, construct the open and close price\nfor(i=0;i<values.length-1;i++){formattedHistory.push({timestamp:values[i].timestamp,open:parseFloat(values[i].priceUSD),close:parseFloat(values[i+1].priceUSD)});}return _context6.abrupt(\"return\",formattedHistory);case 27:_context6.prev=27;_context6.t0=_context6[\"catch\"](8);console.log(_context6.t0);console.log('error fetching blocks');return _context6.abrupt(\"return\",[]);case 32:case\"end\":return _context6.stop();}}},_callee6,null,[[8,27]]);}));return function getIntervalTokenData(_x9,_x10){return _ref8.apply(this,arguments);};}();var getTokenChartData=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(tokenAddress){var data,utcEndTime,utcStartTime,startTime,allFound,skip,result,dayIndexSet,dayIndexArray,oneDay,timestamp,latestLiquidityUSD,latestPriceUSD,latestPairDatas,index,nextDay,currentDayIndex;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:data=[];utcEndTime=dayjs.utc();utcStartTime=utcEndTime.subtract(1,'year');startTime=utcStartTime.startOf('minute').unix()-1;_context7.prev=4;allFound=false;skip=0;case 7:if(allFound){_context7.next=16;break;}_context7.next=10;return client.query({query:TOKEN_CHART,variables:{tokenAddr:tokenAddress,skip:skip},fetchPolicy:'cache-first'});case 10:result=_context7.sent;if(result.data.tokenDayDatas.length<1000){allFound=true;}skip+=1000;data=data.concat(result.data.tokenDayDatas);_context7.next=7;break;case 16:dayIndexSet=new Set();dayIndexArray=[];oneDay=24*60*60;data.forEach(function(dayData,i){// add the day index to the set of days\ndayIndexSet.add((data[i].date/oneDay).toFixed(0));dayIndexArray.push(data[i]);dayData.dailyVolumeUSD=parseFloat(dayData.dailyVolumeUSD);});// fill in empty days\ntimestamp=data[0]&&data[0].date?data[0].date:startTime;latestLiquidityUSD=data[0]&&data[0].totalLiquidityUSD;latestPriceUSD=data[0]&&data[0].priceUSD;latestPairDatas=data[0]&&data[0].mostLiquidPairs;index=1;while(timestamp<utcEndTime.startOf('minute').unix()-oneDay){nextDay=timestamp+oneDay;currentDayIndex=(nextDay/oneDay).toFixed(0);if(!dayIndexSet.has(currentDayIndex)){data.push({date:nextDay,dayString:nextDay,dailyVolumeUSD:0,priceUSD:latestPriceUSD,totalLiquidityUSD:latestLiquidityUSD,mostLiquidPairs:latestPairDatas});}else{latestLiquidityUSD=dayIndexArray[index].totalLiquidityUSD;latestPriceUSD=dayIndexArray[index].priceUSD;latestPairDatas=dayIndexArray[index].mostLiquidPairs;index=index+1;}timestamp=nextDay;}data=data.sort(function(a,b){return parseInt(a.date)>parseInt(b.date)?1:-1;});_context7.next=32;break;case 29:_context7.prev=29;_context7.t0=_context7[\"catch\"](4);console.log(_context7.t0);case 32:return _context7.abrupt(\"return\",data);case 33:case\"end\":return _context7.stop();}}},_callee7,null,[[4,29]]);}));return function getTokenChartData(_x11){return _ref9.apply(this,arguments);};}();export function Updater(){var _useTokenDataContext=useTokenDataContext(),_useTokenDataContext2=_slicedToArray(_useTokenDataContext,2),updateTopTokens=_useTokenDataContext2[1].updateTopTokens;var _useEthPrice=useEthPrice(),_useEthPrice2=_slicedToArray(_useEthPrice,2),ethPrice=_useEthPrice2[0],ethPriceOld=_useEthPrice2[1];useEffect(function(){function getData(){return _getData.apply(this,arguments);}function _getData(){_getData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var topTokens;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return getTopTokens(ethPrice,ethPriceOld);case 2:topTokens=_context8.sent;topTokens&&updateTopTokens(topTokens);case 4:case\"end\":return _context8.stop();}}},_callee8);}));return _getData.apply(this,arguments);}ethPrice&&ethPriceOld&&getData();},[ethPrice,ethPriceOld,updateTopTokens]);return null;}export function useTokenData(tokenAddress){var _useTokenDataContext3=useTokenDataContext(),_useTokenDataContext4=_slicedToArray(_useTokenDataContext3,2),state=_useTokenDataContext4[0],update=_useTokenDataContext4[1].update;var _useEthPrice3=useEthPrice(),_useEthPrice4=_slicedToArray(_useEthPrice3,2),ethPrice=_useEthPrice4[0],ethPriceOld=_useEthPrice4[1];var tokenData=state===null||state===void 0?void 0:state[tokenAddress];useEffect(function(){if(!tokenData&&ethPrice&&ethPriceOld&&isAddress(tokenAddress)){getTokenData(tokenAddress,ethPrice,ethPriceOld).then(function(data){update(tokenAddress,data);});}},[ethPrice,ethPriceOld,tokenAddress,tokenData,update]);return tokenData||{};}export function useTokenTransactions(tokenAddress){var _state$tokenAddress;var _useTokenDataContext5=useTokenDataContext(),_useTokenDataContext6=_slicedToArray(_useTokenDataContext5,2),state=_useTokenDataContext6[0],updateTokenTxns=_useTokenDataContext6[1].updateTokenTxns;var tokenTxns=state===null||state===void 0?void 0:(_state$tokenAddress=state[tokenAddress])===null||_state$tokenAddress===void 0?void 0:_state$tokenAddress.txns;var allPairsFormatted=state[tokenAddress]&&state[tokenAddress].TOKEN_PAIRS_KEY&&state[tokenAddress].TOKEN_PAIRS_KEY.map(function(pair){return pair.id;});useEffect(function(){function checkForTxns(){return _checkForTxns.apply(this,arguments);}function _checkForTxns(){_checkForTxns=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var transactions;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:if(!(!tokenTxns&&allPairsFormatted)){_context9.next=5;break;}_context9.next=3;return getTokenTransactions(allPairsFormatted);case 3:transactions=_context9.sent;updateTokenTxns(tokenAddress,transactions);case 5:case\"end\":return _context9.stop();}}},_callee9);}));return _checkForTxns.apply(this,arguments);}checkForTxns();},[tokenTxns,tokenAddress,updateTokenTxns,allPairsFormatted]);return tokenTxns||[];}export function useTokenPairs(tokenAddress){var _state$tokenAddress2;var _useTokenDataContext7=useTokenDataContext(),_useTokenDataContext8=_slicedToArray(_useTokenDataContext7,2),state=_useTokenDataContext8[0],updateAllPairs=_useTokenDataContext8[1].updateAllPairs;var tokenPairs=state===null||state===void 0?void 0:(_state$tokenAddress2=state[tokenAddress])===null||_state$tokenAddress2===void 0?void 0:_state$tokenAddress2[TOKEN_PAIRS_KEY];useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){var allPairs;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return getTokenPairs(tokenAddress);case 2:allPairs=_context10.sent;updateAllPairs(tokenAddress,allPairs);case 4:case\"end\":return _context10.stop();}}},_callee10);}));return _fetchData.apply(this,arguments);}if(!tokenPairs&&isAddress(tokenAddress)){fetchData();}},[tokenAddress,tokenPairs,updateAllPairs]);return tokenPairs||[];}export function useTokenChartData(tokenAddress){var _state$tokenAddress3;var _useTokenDataContext9=useTokenDataContext(),_useTokenDataContext10=_slicedToArray(_useTokenDataContext9,2),state=_useTokenDataContext10[0],updateChartData=_useTokenDataContext10[1].updateChartData;var chartData=state===null||state===void 0?void 0:(_state$tokenAddress3=state[tokenAddress])===null||_state$tokenAddress3===void 0?void 0:_state$tokenAddress3.chartData;useEffect(function(){function checkForChartData(){return _checkForChartData.apply(this,arguments);}function _checkForChartData(){_checkForChartData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(){var data;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:if(chartData){_context11.next=5;break;}_context11.next=3;return getTokenChartData(tokenAddress);case 3:data=_context11.sent;updateChartData(tokenAddress,data);case 5:case\"end\":return _context11.stop();}}},_callee11);}));return _checkForChartData.apply(this,arguments);}checkForChartData();},[chartData,tokenAddress,updateChartData]);return chartData;}/**\n * get candlestick data for a token - saves in context based on the window and the\n * interval size\n * @param {*} tokenAddress\n * @param {*} timeWindow // a preset time window from constant - how far back to look\n * @param {*} interval  // the chunk size in seconds - default is 1 hour of 3600s\n */export function useTokenPriceData(tokenAddress,timeWindow){var _state$tokenAddress4,_state$tokenAddress4$;var interval=arguments.length>2&&arguments[2]!==undefined?arguments[2]:3600;var _useTokenDataContext11=useTokenDataContext(),_useTokenDataContext12=_slicedToArray(_useTokenDataContext11,2),state=_useTokenDataContext12[0],updatePriceData=_useTokenDataContext12[1].updatePriceData;var chartData=state===null||state===void 0?void 0:(_state$tokenAddress4=state[tokenAddress])===null||_state$tokenAddress4===void 0?void 0:(_state$tokenAddress4$=_state$tokenAddress4[timeWindow])===null||_state$tokenAddress4$===void 0?void 0:_state$tokenAddress4$[interval];var _useLatestBlocks=useLatestBlocks(),_useLatestBlocks2=_slicedToArray(_useLatestBlocks,1),latestBlock=_useLatestBlocks2[0];useEffect(function(){var currentTime=dayjs.utc();var windowSize=timeWindow===timeframeOptions.MONTH?'month':'week';var startTime=timeWindow===timeframeOptions.ALL_TIME?1589760000:currentTime.subtract(1,windowSize).startOf('hour').unix();function fetch(){return _fetch.apply(this,arguments);}function _fetch(){_fetch=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(){var data;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return getIntervalTokenData(tokenAddress,startTime,interval,latestBlock);case 2:data=_context12.sent;updatePriceData(tokenAddress,data,timeWindow,interval);case 4:case\"end\":return _context12.stop();}}},_callee12);}));return _fetch.apply(this,arguments);}if(!chartData){fetch();}},[chartData,interval,timeWindow,tokenAddress,updatePriceData,latestBlock]);return chartData;}export function useAllTokenData(){var _useTokenDataContext13=useTokenDataContext(),_useTokenDataContext14=_slicedToArray(_useTokenDataContext13,1),state=_useTokenDataContext14[0];return state;}","map":{"version":3,"sources":["/Users/macbook/Desktop/juiceswap/juiceswap-docs/src/contexts/TokenData.js"],"names":["React","createContext","useContext","useReducer","useMemo","useCallback","useEffect","client","TOKEN_DATA","FILTERED_TRANSACTIONS","TOKEN_CHART","TOKENS_CURRENT","TOKENS_DYNAMIC","PRICES_BY_BLOCK","PAIR_DATA","useEthPrice","dayjs","utc","get2DayPercentChange","getPercentChange","getBlockFromTimestamp","isAddress","getBlocksFromTimestamps","splitQuery","timeframeOptions","useLatestBlocks","updateNameData","UPDATE","UPDATE_TOKEN_TXNS","UPDATE_CHART_DATA","UPDATE_PRICE_DATA","UPDATE_TOP_TOKENS","UPDATE_ALL_PAIRS","TOKEN_PAIRS_KEY","extend","TokenDataContext","useTokenDataContext","reducer","state","type","payload","tokenAddress","data","topTokens","added","map","token","id","address","transactions","txns","chartData","timeWindow","interval","allPairs","Error","Provider","children","dispatch","update","updateTopTokens","updateTokenTxns","updateChartData","updateAllPairs","updatePriceData","getTopTokens","ethPrice","ethPriceOld","utcCurrentTime","utcOneDayBack","subtract","unix","utcTwoDaysBack","oneDayBlock","twoDayBlock","query","fetchPolicy","current","oneDayResult","twoDayResult","oneDayData","tokens","reduce","obj","cur","i","twoDayData","Promise","all","oneDayHistory","twoDayHistory","tradeVolumeUSD","oneDayVolumeUSD","volumeChangeUSD","txCount","oneDayTxns","txnChange","currentLiquidityUSD","totalLiquidity","derivedETH","oldLiquidityUSD","priceChangeUSD","priceUSD","totalLiquidityUSD","parseFloat","liquidityChangeUSD","oneDayVolumeETH","tradeVolume","token0","aaveData","result","pairs","reserveUSD","bulkResults","console","log","getTokenData","startOf","untrackedVolumeUSD","oneDayVolumeUT","volumeChangeUT","getTokenTransactions","allPairsFormatted","variables","mints","burns","swaps","getTokenPairs","concat","getIntervalTokenData","startTime","latestBlock","utcEndTime","time","timestamps","push","length","blocks","filter","b","number","values","row","timestamp","split","index","brow","formattedHistory","open","close","getTokenChartData","utcStartTime","allFound","skip","tokenAddr","tokenDayDatas","dayIndexSet","Set","dayIndexArray","oneDay","forEach","dayData","add","date","toFixed","dailyVolumeUSD","latestLiquidityUSD","latestPriceUSD","latestPairDatas","mostLiquidPairs","nextDay","currentDayIndex","has","dayString","sort","a","parseInt","Updater","getData","useTokenData","tokenData","then","useTokenTransactions","tokenTxns","pair","checkForTxns","useTokenPairs","tokenPairs","fetchData","useTokenChartData","checkForChartData","useTokenPriceData","currentTime","windowSize","MONTH","ALL_TIME","fetch","useAllTokenData"],"mappings":"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","sourcesContent":["import React, { createContext, useContext, useReducer, useMemo, useCallback, useEffect } from 'react'\n\nimport { client } from '../apollo/client'\nimport {\n  TOKEN_DATA,\n  FILTERED_TRANSACTIONS,\n  TOKEN_CHART,\n  TOKENS_CURRENT,\n  TOKENS_DYNAMIC,\n  PRICES_BY_BLOCK,\n  PAIR_DATA,\n} from '../apollo/queries'\n\nimport { useEthPrice } from './GlobalData'\n\nimport dayjs from 'dayjs'\nimport utc from 'dayjs/plugin/utc'\n\nimport {\n  get2DayPercentChange,\n  getPercentChange,\n  getBlockFromTimestamp,\n  isAddress,\n  getBlocksFromTimestamps,\n  splitQuery,\n} from '../utils'\nimport { timeframeOptions } from '../constants'\nimport { useLatestBlocks } from './Application'\nimport { updateNameData } from '../utils/data'\n\nconst UPDATE = 'UPDATE'\nconst UPDATE_TOKEN_TXNS = 'UPDATE_TOKEN_TXNS'\nconst UPDATE_CHART_DATA = 'UPDATE_CHART_DATA'\nconst UPDATE_PRICE_DATA = 'UPDATE_PRICE_DATA'\nconst UPDATE_TOP_TOKENS = ' UPDATE_TOP_TOKENS'\nconst UPDATE_ALL_PAIRS = 'UPDATE_ALL_PAIRS'\n\nconst TOKEN_PAIRS_KEY = 'TOKEN_PAIRS_KEY'\n\ndayjs.extend(utc)\n\nconst TokenDataContext = createContext()\n\nfunction useTokenDataContext() {\n  return useContext(TokenDataContext)\n}\n\nfunction reducer(state, { type, payload }) {\n  switch (type) {\n    case UPDATE: {\n      const { tokenAddress, data } = payload\n      return {\n        ...state,\n        [tokenAddress]: {\n          ...state?.[tokenAddress],\n          ...data,\n        },\n      }\n    }\n    case UPDATE_TOP_TOKENS: {\n      const { topTokens } = payload\n      let added = {}\n      topTokens &&\n        topTokens.map((token) => {\n          return (added[token.id] = token)\n        })\n      return {\n        ...state,\n        ...added,\n      }\n    }\n\n    case UPDATE_TOKEN_TXNS: {\n      const { address, transactions } = payload\n      return {\n        ...state,\n        [address]: {\n          ...state?.[address],\n          txns: transactions,\n        },\n      }\n    }\n    case UPDATE_CHART_DATA: {\n      const { address, chartData } = payload\n      return {\n        ...state,\n        [address]: {\n          ...state?.[address],\n          chartData,\n        },\n      }\n    }\n\n    case UPDATE_PRICE_DATA: {\n      const { address, data, timeWindow, interval } = payload\n      return {\n        ...state,\n        [address]: {\n          ...state?.[address],\n          [timeWindow]: {\n            ...state?.[address]?.[timeWindow],\n            [interval]: data,\n          },\n        },\n      }\n    }\n\n    case UPDATE_ALL_PAIRS: {\n      const { address, allPairs } = payload\n      return {\n        ...state,\n        [address]: {\n          ...state?.[address],\n          [TOKEN_PAIRS_KEY]: allPairs,\n        },\n      }\n    }\n    default: {\n      throw Error(`Unexpected action type in DataContext reducer: '${type}'.`)\n    }\n  }\n}\n\nexport default function Provider({ children }) {\n  const [state, dispatch] = useReducer(reducer, {})\n  const update = useCallback((tokenAddress, data) => {\n    dispatch({\n      type: UPDATE,\n      payload: {\n        tokenAddress,\n        data,\n      },\n    })\n  }, [])\n\n  const updateTopTokens = useCallback((topTokens) => {\n    dispatch({\n      type: UPDATE_TOP_TOKENS,\n      payload: {\n        topTokens,\n      },\n    })\n  }, [])\n\n  const updateTokenTxns = useCallback((address, transactions) => {\n    dispatch({\n      type: UPDATE_TOKEN_TXNS,\n      payload: { address, transactions },\n    })\n  }, [])\n\n  const updateChartData = useCallback((address, chartData) => {\n    dispatch({\n      type: UPDATE_CHART_DATA,\n      payload: { address, chartData },\n    })\n  }, [])\n\n  const updateAllPairs = useCallback((address, allPairs) => {\n    dispatch({\n      type: UPDATE_ALL_PAIRS,\n      payload: { address, allPairs },\n    })\n  }, [])\n\n  const updatePriceData = useCallback((address, data, timeWindow, interval) => {\n    dispatch({\n      type: UPDATE_PRICE_DATA,\n      payload: { address, data, timeWindow, interval },\n    })\n  }, [])\n\n  return (\n    <TokenDataContext.Provider\n      value={useMemo(\n        () => [\n          state,\n          {\n            update,\n            updateTokenTxns,\n            updateChartData,\n            updateTopTokens,\n            updateAllPairs,\n            updatePriceData,\n          },\n        ],\n        [state, update, updateTokenTxns, updateChartData, updateTopTokens, updateAllPairs, updatePriceData]\n      )}\n    >\n      {children}\n    </TokenDataContext.Provider>\n  )\n}\n\nconst getTopTokens = async (ethPrice, ethPriceOld) => {\n  const utcCurrentTime = dayjs()\n  const utcOneDayBack = utcCurrentTime.subtract(1, 'day').unix()\n  const utcTwoDaysBack = utcCurrentTime.subtract(2, 'day').unix()\n  let oneDayBlock = await getBlockFromTimestamp(utcOneDayBack)\n  let twoDayBlock = await getBlockFromTimestamp(utcTwoDaysBack)\n\n  try {\n    let current = await client.query({\n      query: TOKENS_CURRENT,\n      fetchPolicy: 'cache-first',\n    })\n\n    let oneDayResult = await client.query({\n      query: TOKENS_DYNAMIC(oneDayBlock),\n      fetchPolicy: 'cache-first',\n    })\n\n    let twoDayResult = await client.query({\n      query: TOKENS_DYNAMIC(twoDayBlock),\n      fetchPolicy: 'cache-first',\n    })\n\n    let oneDayData = oneDayResult?.data?.tokens.reduce((obj, cur, i) => {\n      return { ...obj, [cur.id]: cur }\n    }, {})\n\n    let twoDayData = twoDayResult?.data?.tokens.reduce((obj, cur, i) => {\n      return { ...obj, [cur.id]: cur }\n    }, {})\n\n    let bulkResults = await Promise.all(\n      current &&\n        oneDayData &&\n        twoDayData &&\n        current?.data?.tokens.map(async (token) => {\n          let data = token\n\n          // let liquidityDataThisToken = liquidityData?.[token.id]\n          let oneDayHistory = oneDayData?.[token.id]\n          let twoDayHistory = twoDayData?.[token.id]\n\n          // catch the case where token wasnt in top list in previous days\n          if (!oneDayHistory) {\n            let oneDayResult = await client.query({\n              query: TOKEN_DATA(token.id, oneDayBlock),\n              fetchPolicy: 'cache-first',\n            })\n            oneDayHistory = oneDayResult.data.tokens[0]\n          }\n          if (!twoDayHistory) {\n            let twoDayResult = await client.query({\n              query: TOKEN_DATA(token.id, twoDayBlock),\n              fetchPolicy: 'cache-first',\n            })\n            twoDayHistory = twoDayResult.data.tokens[0]\n          }\n\n          // calculate percentage changes and daily changes\n          const [oneDayVolumeUSD, volumeChangeUSD] = get2DayPercentChange(\n            data.tradeVolumeUSD,\n            oneDayHistory?.tradeVolumeUSD ?? 0,\n            twoDayHistory?.tradeVolumeUSD ?? 0\n          )\n          const [oneDayTxns, txnChange] = get2DayPercentChange(\n            data.txCount,\n            oneDayHistory?.txCount ?? 0,\n            twoDayHistory?.txCount ?? 0\n          )\n\n          const currentLiquidityUSD = data?.totalLiquidity * ethPrice * data?.derivedETH\n          const oldLiquidityUSD = oneDayHistory?.totalLiquidity * ethPriceOld * oneDayHistory?.derivedETH\n\n          // percent changes\n          const priceChangeUSD = getPercentChange(\n            data?.derivedETH * ethPrice,\n            oneDayHistory?.derivedETH ? oneDayHistory?.derivedETH * ethPriceOld : 0\n          )\n\n          // set data\n          data.priceUSD = data?.derivedETH * ethPrice\n          data.totalLiquidityUSD = currentLiquidityUSD\n          data.oneDayVolumeUSD = parseFloat(oneDayVolumeUSD)\n          data.volumeChangeUSD = volumeChangeUSD\n          data.priceChangeUSD = priceChangeUSD\n          data.liquidityChangeUSD = getPercentChange(currentLiquidityUSD ?? 0, oldLiquidityUSD ?? 0)\n          data.oneDayTxns = oneDayTxns\n          data.txnChange = txnChange\n\n          // new tokens\n          if (!oneDayHistory && data) {\n            data.oneDayVolumeUSD = data.tradeVolumeUSD\n            data.oneDayVolumeETH = data.tradeVolume * data.derivedETH\n            data.oneDayTxns = data.txCount\n          }\n\n          // update name data for\n          updateNameData({\n            token0: data,\n          })\n\n          // HOTFIX for Aave\n          if (data.id === '0x7fc66500c84a76ad7e9c93437bfc5ac33e2ddae9') {\n            const aaveData = await client.query({\n              query: PAIR_DATA('0xdfc14d2af169b0d36c4eff567ada9b2e0cae044f'),\n              fetchPolicy: 'cache-first',\n            })\n            const result = aaveData.data.pairs[0]\n            data.totalLiquidityUSD = parseFloat(result.reserveUSD) / 2\n            data.liquidityChangeUSD = 0\n            data.priceChangeUSD = 0\n          }\n\n          return data\n        })\n    )\n\n    return bulkResults\n\n    // calculate percentage changes and daily changes\n  } catch (e) {\n    console.log(e)\n  }\n}\n\nconst getTokenData = async (address, ethPrice, ethPriceOld) => {\n  const utcCurrentTime = dayjs()\n  const utcOneDayBack = utcCurrentTime.subtract(1, 'day').startOf('minute').unix()\n  const utcTwoDaysBack = utcCurrentTime.subtract(2, 'day').startOf('minute').unix()\n  let oneDayBlock = await getBlockFromTimestamp(utcOneDayBack)\n  let twoDayBlock = await getBlockFromTimestamp(utcTwoDaysBack)\n\n  // initialize data arrays\n  let data = {}\n  let oneDayData = {}\n  let twoDayData = {}\n\n  try {\n    // fetch all current and historical data\n    let result = await client.query({\n      query: TOKEN_DATA(address),\n      fetchPolicy: 'cache-first',\n    })\n    data = result?.data?.tokens?.[0]\n\n    // get results from 24 hours in past\n    let oneDayResult = await client.query({\n      query: TOKEN_DATA(address, oneDayBlock),\n      fetchPolicy: 'cache-first',\n    })\n    oneDayData = oneDayResult.data.tokens[0]\n\n    // get results from 48 hours in past\n    let twoDayResult = await client.query({\n      query: TOKEN_DATA(address, twoDayBlock),\n      fetchPolicy: 'cache-first',\n    })\n    twoDayData = twoDayResult.data.tokens[0]\n\n    // catch the case where token wasnt in top list in previous days\n    if (!oneDayData) {\n      let oneDayResult = await client.query({\n        query: TOKEN_DATA(address, oneDayBlock),\n        fetchPolicy: 'cache-first',\n      })\n      oneDayData = oneDayResult.data.tokens[0]\n    }\n    if (!twoDayData) {\n      let twoDayResult = await client.query({\n        query: TOKEN_DATA(address, twoDayBlock),\n        fetchPolicy: 'cache-first',\n      })\n      twoDayData = twoDayResult.data.tokens[0]\n    }\n\n    // calculate percentage changes and daily changes\n    const [oneDayVolumeUSD, volumeChangeUSD] = get2DayPercentChange(\n      data.tradeVolumeUSD,\n      oneDayData?.tradeVolumeUSD ?? 0,\n      twoDayData?.tradeVolumeUSD ?? 0\n    )\n\n    // calculate percentage changes and daily changes\n    const [oneDayVolumeUT, volumeChangeUT] = get2DayPercentChange(\n      data.untrackedVolumeUSD,\n      oneDayData?.untrackedVolumeUSD ?? 0,\n      twoDayData?.untrackedVolumeUSD ?? 0\n    )\n\n    // calculate percentage changes and daily changes\n    const [oneDayTxns, txnChange] = get2DayPercentChange(\n      data.txCount,\n      oneDayData?.txCount ?? 0,\n      twoDayData?.txCount ?? 0\n    )\n\n    const priceChangeUSD = getPercentChange(\n      data?.derivedETH * ethPrice,\n      parseFloat(oneDayData?.derivedETH ?? 0) * ethPriceOld\n    )\n\n    const currentLiquidityUSD = data?.totalLiquidity * ethPrice * data?.derivedETH\n    const oldLiquidityUSD = oneDayData?.totalLiquidity * ethPriceOld * oneDayData?.derivedETH\n\n    // set data\n    data.priceUSD = data?.derivedETH * ethPrice\n    data.totalLiquidityUSD = currentLiquidityUSD\n    data.oneDayVolumeUSD = oneDayVolumeUSD\n    data.volumeChangeUSD = volumeChangeUSD\n    data.priceChangeUSD = priceChangeUSD\n    data.oneDayVolumeUT = oneDayVolumeUT\n    data.volumeChangeUT = volumeChangeUT\n    const liquidityChangeUSD = getPercentChange(currentLiquidityUSD ?? 0, oldLiquidityUSD ?? 0)\n    data.liquidityChangeUSD = liquidityChangeUSD\n    data.oneDayTxns = oneDayTxns\n    data.txnChange = txnChange\n\n    // new tokens\n    if (!oneDayData && data) {\n      data.oneDayVolumeUSD = data.tradeVolumeUSD\n      data.oneDayVolumeETH = data.tradeVolume * data.derivedETH\n      data.oneDayTxns = data.txCount\n    }\n\n    // update name data for\n    updateNameData({\n      token0: data,\n    })\n\n    // HOTFIX for Aave\n    if (data.id === '0x7fc66500c84a76ad7e9c93437bfc5ac33e2ddae9') {\n      const aaveData = await client.query({\n        query: PAIR_DATA('0xdfc14d2af169b0d36c4eff567ada9b2e0cae044f'),\n        fetchPolicy: 'cache-first',\n      })\n      const result = aaveData.data.pairs[0]\n      data.totalLiquidityUSD = parseFloat(result.reserveUSD) / 2\n      data.liquidityChangeUSD = 0\n      data.priceChangeUSD = 0\n    }\n  } catch (e) {\n    console.log(e)\n  }\n  return data\n}\n\nconst getTokenTransactions = async (allPairsFormatted) => {\n  const transactions = {}\n  try {\n    let result = await client.query({\n      query: FILTERED_TRANSACTIONS,\n      variables: {\n        allPairs: allPairsFormatted,\n      },\n      fetchPolicy: 'cache-first',\n    })\n    transactions.mints = result.data.mints\n    transactions.burns = result.data.burns\n    transactions.swaps = result.data.swaps\n  } catch (e) {\n    console.log(e)\n  }\n  return transactions\n}\n\nconst getTokenPairs = async (tokenAddress) => {\n  try {\n    // fetch all current and historical data\n    let result = await client.query({\n      query: TOKEN_DATA(tokenAddress),\n      fetchPolicy: 'cache-first',\n    })\n    return result.data?.['pairs0'].concat(result.data?.['pairs1'])\n  } catch (e) {\n    console.log(e)\n  }\n}\n\nconst getIntervalTokenData = async (tokenAddress, startTime, interval = 3600, latestBlock) => {\n  const utcEndTime = dayjs.utc()\n  let time = startTime\n\n  // create an array of hour start times until we reach current hour\n  // buffer by half hour to catch case where graph isnt synced to latest block\n  const timestamps = []\n  while (time < utcEndTime.unix()) {\n    timestamps.push(time)\n    time += interval\n  }\n\n  // backout if invalid timestamp format\n  if (timestamps.length === 0) {\n    return []\n  }\n\n  // once you have all the timestamps, get the blocks for each timestamp in a bulk query\n  let blocks\n  try {\n    blocks = await getBlocksFromTimestamps(timestamps, 100)\n\n    // catch failing case\n    if (!blocks || blocks.length === 0) {\n      return []\n    }\n\n    if (latestBlock) {\n      blocks = blocks.filter((b) => {\n        return parseFloat(b.number) <= parseFloat(latestBlock)\n      })\n    }\n\n    let result = await splitQuery(PRICES_BY_BLOCK, client, [tokenAddress], blocks, 50)\n\n    // format token ETH price results\n    let values = []\n    for (var row in result) {\n      let timestamp = row.split('t')[1]\n      let derivedETH = parseFloat(result[row]?.derivedETH)\n      if (timestamp) {\n        values.push({\n          timestamp,\n          derivedETH,\n        })\n      }\n    }\n\n    // go through eth usd prices and assign to original values array\n    let index = 0\n    for (var brow in result) {\n      let timestamp = brow.split('b')[1]\n      if (timestamp) {\n        values[index].priceUSD = result[brow].ethPrice * values[index].derivedETH\n        index += 1\n      }\n    }\n\n    let formattedHistory = []\n\n    // for each hour, construct the open and close price\n    for (let i = 0; i < values.length - 1; i++) {\n      formattedHistory.push({\n        timestamp: values[i].timestamp,\n        open: parseFloat(values[i].priceUSD),\n        close: parseFloat(values[i + 1].priceUSD),\n      })\n    }\n\n    return formattedHistory\n  } catch (e) {\n    console.log(e)\n    console.log('error fetching blocks')\n    return []\n  }\n}\n\nconst getTokenChartData = async (tokenAddress) => {\n  let data = []\n  const utcEndTime = dayjs.utc()\n  let utcStartTime = utcEndTime.subtract(1, 'year')\n  let startTime = utcStartTime.startOf('minute').unix() - 1\n\n  try {\n    let allFound = false\n    let skip = 0\n    while (!allFound) {\n      let result = await client.query({\n        query: TOKEN_CHART,\n        variables: {\n          tokenAddr: tokenAddress,\n          skip,\n        },\n        fetchPolicy: 'cache-first',\n      })\n      if (result.data.tokenDayDatas.length < 1000) {\n        allFound = true\n      }\n      skip += 1000\n      data = data.concat(result.data.tokenDayDatas)\n    }\n\n    let dayIndexSet = new Set()\n    let dayIndexArray = []\n    const oneDay = 24 * 60 * 60\n    data.forEach((dayData, i) => {\n      // add the day index to the set of days\n      dayIndexSet.add((data[i].date / oneDay).toFixed(0))\n      dayIndexArray.push(data[i])\n      dayData.dailyVolumeUSD = parseFloat(dayData.dailyVolumeUSD)\n    })\n\n    // fill in empty days\n    let timestamp = data[0] && data[0].date ? data[0].date : startTime\n    let latestLiquidityUSD = data[0] && data[0].totalLiquidityUSD\n    let latestPriceUSD = data[0] && data[0].priceUSD\n    let latestPairDatas = data[0] && data[0].mostLiquidPairs\n    let index = 1\n    while (timestamp < utcEndTime.startOf('minute').unix() - oneDay) {\n      const nextDay = timestamp + oneDay\n      let currentDayIndex = (nextDay / oneDay).toFixed(0)\n      if (!dayIndexSet.has(currentDayIndex)) {\n        data.push({\n          date: nextDay,\n          dayString: nextDay,\n          dailyVolumeUSD: 0,\n          priceUSD: latestPriceUSD,\n          totalLiquidityUSD: latestLiquidityUSD,\n          mostLiquidPairs: latestPairDatas,\n        })\n      } else {\n        latestLiquidityUSD = dayIndexArray[index].totalLiquidityUSD\n        latestPriceUSD = dayIndexArray[index].priceUSD\n        latestPairDatas = dayIndexArray[index].mostLiquidPairs\n        index = index + 1\n      }\n      timestamp = nextDay\n    }\n    data = data.sort((a, b) => (parseInt(a.date) > parseInt(b.date) ? 1 : -1))\n  } catch (e) {\n    console.log(e)\n  }\n  return data\n}\n\nexport function Updater() {\n  const [, { updateTopTokens }] = useTokenDataContext()\n  const [ethPrice, ethPriceOld] = useEthPrice()\n  useEffect(() => {\n    async function getData() {\n      // get top pairs for overview list\n      let topTokens = await getTopTokens(ethPrice, ethPriceOld)\n      topTokens && updateTopTokens(topTokens)\n    }\n    ethPrice && ethPriceOld && getData()\n  }, [ethPrice, ethPriceOld, updateTopTokens])\n  return null\n}\n\nexport function useTokenData(tokenAddress) {\n  const [state, { update }] = useTokenDataContext()\n  const [ethPrice, ethPriceOld] = useEthPrice()\n  const tokenData = state?.[tokenAddress]\n\n  useEffect(() => {\n    if (!tokenData && ethPrice && ethPriceOld && isAddress(tokenAddress)) {\n      getTokenData(tokenAddress, ethPrice, ethPriceOld).then((data) => {\n        update(tokenAddress, data)\n      })\n    }\n  }, [ethPrice, ethPriceOld, tokenAddress, tokenData, update])\n\n  return tokenData || {}\n}\n\nexport function useTokenTransactions(tokenAddress) {\n  const [state, { updateTokenTxns }] = useTokenDataContext()\n  const tokenTxns = state?.[tokenAddress]?.txns\n\n  const allPairsFormatted =\n    state[tokenAddress] &&\n    state[tokenAddress].TOKEN_PAIRS_KEY &&\n    state[tokenAddress].TOKEN_PAIRS_KEY.map((pair) => {\n      return pair.id\n    })\n\n  useEffect(() => {\n    async function checkForTxns() {\n      if (!tokenTxns && allPairsFormatted) {\n        let transactions = await getTokenTransactions(allPairsFormatted)\n        updateTokenTxns(tokenAddress, transactions)\n      }\n    }\n    checkForTxns()\n  }, [tokenTxns, tokenAddress, updateTokenTxns, allPairsFormatted])\n\n  return tokenTxns || []\n}\n\nexport function useTokenPairs(tokenAddress) {\n  const [state, { updateAllPairs }] = useTokenDataContext()\n  const tokenPairs = state?.[tokenAddress]?.[TOKEN_PAIRS_KEY]\n\n  useEffect(() => {\n    async function fetchData() {\n      let allPairs = await getTokenPairs(tokenAddress)\n      updateAllPairs(tokenAddress, allPairs)\n    }\n    if (!tokenPairs && isAddress(tokenAddress)) {\n      fetchData()\n    }\n  }, [tokenAddress, tokenPairs, updateAllPairs])\n\n  return tokenPairs || []\n}\n\nexport function useTokenChartData(tokenAddress) {\n  const [state, { updateChartData }] = useTokenDataContext()\n  const chartData = state?.[tokenAddress]?.chartData\n  useEffect(() => {\n    async function checkForChartData() {\n      if (!chartData) {\n        let data = await getTokenChartData(tokenAddress)\n        updateChartData(tokenAddress, data)\n      }\n    }\n    checkForChartData()\n  }, [chartData, tokenAddress, updateChartData])\n  return chartData\n}\n\n/**\n * get candlestick data for a token - saves in context based on the window and the\n * interval size\n * @param {*} tokenAddress\n * @param {*} timeWindow // a preset time window from constant - how far back to look\n * @param {*} interval  // the chunk size in seconds - default is 1 hour of 3600s\n */\nexport function useTokenPriceData(tokenAddress, timeWindow, interval = 3600) {\n  const [state, { updatePriceData }] = useTokenDataContext()\n  const chartData = state?.[tokenAddress]?.[timeWindow]?.[interval]\n  const [latestBlock] = useLatestBlocks()\n\n  useEffect(() => {\n    const currentTime = dayjs.utc()\n    const windowSize = timeWindow === timeframeOptions.MONTH ? 'month' : 'week'\n    const startTime =\n      timeWindow === timeframeOptions.ALL_TIME ? 1589760000 : currentTime.subtract(1, windowSize).startOf('hour').unix()\n\n    async function fetch() {\n      let data = await getIntervalTokenData(tokenAddress, startTime, interval, latestBlock)\n      updatePriceData(tokenAddress, data, timeWindow, interval)\n    }\n    if (!chartData) {\n      fetch()\n    }\n  }, [chartData, interval, timeWindow, tokenAddress, updatePriceData, latestBlock])\n\n  return chartData\n}\n\nexport function useAllTokenData() {\n  const [state] = useTokenDataContext()\n  return state\n}\n"]},"metadata":{},"sourceType":"module"}