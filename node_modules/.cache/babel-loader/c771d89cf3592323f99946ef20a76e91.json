{"ast":null,"code":"import _regeneratorRuntime from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/macbook/Desktop/juiceswap/juiceswap-docs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{createContext,useContext,useReducer,useMemo,useCallback,useEffect,useState}from'react';import{client}from'../apollo/client';import{PAIR_DATA,PAIR_CHART,FILTERED_TRANSACTIONS,PAIRS_CURRENT,PAIRS_BULK,PAIRS_HISTORICAL_BULK,HOURLY_PAIR_RATES}from'../apollo/queries';import{useEthPrice}from'./GlobalData';import dayjs from'dayjs';import utc from'dayjs/plugin/utc';import{getPercentChange,get2DayPercentChange,isAddress,getBlocksFromTimestamps,getTimestampsForChanges,splitQuery}from'../utils';import{timeframeOptions}from'../constants';import{useLatestBlocks}from'./Application';import{updateNameData}from'../utils/data';var UPDATE='UPDATE';var UPDATE_PAIR_TXNS='UPDATE_PAIR_TXNS';var UPDATE_CHART_DATA='UPDATE_CHART_DATA';var UPDATE_TOP_PAIRS='UPDATE_TOP_PAIRS';var UPDATE_HOURLY_DATA='UPDATE_HOURLY_DATA';dayjs.extend(utc);export function safeAccess(object,path){return object?path.reduce(function(accumulator,currentValue){return accumulator&&accumulator[currentValue]?accumulator[currentValue]:null;},object):null;}var PairDataContext=createContext();function usePairDataContext(){return useContext(PairDataContext);}function reducer(state,_ref){var type=_ref.type,payload=_ref.payload;switch(type){case UPDATE:{var pairAddress=payload.pairAddress,data=payload.data;return _objectSpread(_objectSpread({},state),{},_defineProperty({},pairAddress,_objectSpread(_objectSpread({},state===null||state===void 0?void 0:state[pairAddress]),data)));}case UPDATE_TOP_PAIRS:{var topPairs=payload.topPairs;var added={};topPairs.map(function(pair){return added[pair.id]=pair;});return _objectSpread(_objectSpread({},state),added);}case UPDATE_PAIR_TXNS:{var address=payload.address,transactions=payload.transactions;return _objectSpread(_objectSpread({},state),{},_defineProperty({},address,_objectSpread(_objectSpread({},safeAccess(state,[address])||{}),{},{txns:transactions})));}case UPDATE_CHART_DATA:{var _address=payload.address,chartData=payload.chartData;return _objectSpread(_objectSpread({},state),{},_defineProperty({},_address,_objectSpread(_objectSpread({},safeAccess(state,[_address])||{}),{},{chartData:chartData})));}case UPDATE_HOURLY_DATA:{var _state$_address;var _address2=payload.address,hourlyData=payload.hourlyData,timeWindow=payload.timeWindow;return _objectSpread(_objectSpread({},state),{},_defineProperty({},_address2,_objectSpread(_objectSpread({},state===null||state===void 0?void 0:state[_address2]),{},{hourlyData:_objectSpread(_objectSpread({},state===null||state===void 0?void 0:(_state$_address=state[_address2])===null||_state$_address===void 0?void 0:_state$_address.hourlyData),{},_defineProperty({},timeWindow,hourlyData))})));}default:{throw Error(\"Unexpected action type in DataContext reducer: '\".concat(type,\"'.\"));}}}export default function Provider(_ref2){var children=_ref2.children;var _useReducer=useReducer(reducer,{}),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// update pair specific data\nvar update=useCallback(function(pairAddress,data){dispatch({type:UPDATE,payload:{pairAddress:pairAddress,data:data}});},[]);var updateTopPairs=useCallback(function(topPairs){dispatch({type:UPDATE_TOP_PAIRS,payload:{topPairs:topPairs}});},[]);var updatePairTxns=useCallback(function(address,transactions){dispatch({type:UPDATE_PAIR_TXNS,payload:{address:address,transactions:transactions}});},[]);var updateChartData=useCallback(function(address,chartData){dispatch({type:UPDATE_CHART_DATA,payload:{address:address,chartData:chartData}});},[]);var updateHourlyData=useCallback(function(address,hourlyData,timeWindow){dispatch({type:UPDATE_HOURLY_DATA,payload:{address:address,hourlyData:hourlyData,timeWindow:timeWindow}});},[]);return/*#__PURE__*/React.createElement(PairDataContext.Provider,{value:useMemo(function(){return[state,{update:update,updatePairTxns:updatePairTxns,updateChartData:updateChartData,updateTopPairs:updateTopPairs,updateHourlyData:updateHourlyData}];},[state,update,updatePairTxns,updateChartData,updateTopPairs,updateHourlyData])},children);}function getBulkPairData(_x,_x2){return _getBulkPairData.apply(this,arguments);}function _getBulkPairData(){_getBulkPairData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(pairList,ethPrice){var _getTimestampsForChan,_getTimestampsForChan2,t1,t2,tWeek,_yield$getBlocksFromT,_yield$getBlocksFromT2,b1,b2,bWeek,_oneDayResult$data,_twoDayResult$data,_oneWeekResult$data,current,_yield$Promise$all,_yield$Promise$all2,oneDayResult,twoDayResult,oneWeekResult,oneDayData,twoDayData,oneWeekData,pairData;return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_getTimestampsForChan=getTimestampsForChanges(),_getTimestampsForChan2=_slicedToArray(_getTimestampsForChan,3),t1=_getTimestampsForChan2[0],t2=_getTimestampsForChan2[1],tWeek=_getTimestampsForChan2[2];_context13.next=3;return getBlocksFromTimestamps([t1,t2,tWeek]);case 3:_yield$getBlocksFromT=_context13.sent;_yield$getBlocksFromT2=_slicedToArray(_yield$getBlocksFromT,3);b1=_yield$getBlocksFromT2[0].number;b2=_yield$getBlocksFromT2[1].number;bWeek=_yield$getBlocksFromT2[2].number;_context13.prev=8;_context13.next=11;return client.query({query:PAIRS_BULK,variables:{allPairs:pairList},fetchPolicy:'cache-first'});case 11:current=_context13.sent;_context13.next=14;return Promise.all([b1,b2,bWeek].map(/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(block){var result;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:result=client.query({query:PAIRS_HISTORICAL_BULK(block,pairList),fetchPolicy:'cache-first'});return _context11.abrupt(\"return\",result);case 2:case\"end\":return _context11.stop();}}},_callee11);}));return function(_x9){return _ref7.apply(this,arguments);};}()));case 14:_yield$Promise$all=_context13.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,3);oneDayResult=_yield$Promise$all2[0];twoDayResult=_yield$Promise$all2[1];oneWeekResult=_yield$Promise$all2[2];oneDayData=oneDayResult===null||oneDayResult===void 0?void 0:(_oneDayResult$data=oneDayResult.data)===null||_oneDayResult$data===void 0?void 0:_oneDayResult$data.pairs.reduce(function(obj,cur,i){return _objectSpread(_objectSpread({},obj),{},_defineProperty({},cur.id,cur));},{});twoDayData=twoDayResult===null||twoDayResult===void 0?void 0:(_twoDayResult$data=twoDayResult.data)===null||_twoDayResult$data===void 0?void 0:_twoDayResult$data.pairs.reduce(function(obj,cur,i){return _objectSpread(_objectSpread({},obj),{},_defineProperty({},cur.id,cur));},{});oneWeekData=oneWeekResult===null||oneWeekResult===void 0?void 0:(_oneWeekResult$data=oneWeekResult.data)===null||_oneWeekResult$data===void 0?void 0:_oneWeekResult$data.pairs.reduce(function(obj,cur,i){return _objectSpread(_objectSpread({},obj),{},_defineProperty({},cur.id,cur));},{});_context13.next=24;return Promise.all(current&&current.data.pairs.map(/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(pair){var data,oneDayHistory,newData,twoDayHistory,_newData,oneWeekHistory,_newData2;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:data=pair;oneDayHistory=oneDayData===null||oneDayData===void 0?void 0:oneDayData[pair.id];if(oneDayHistory){_context12.next=7;break;}_context12.next=5;return client.query({query:PAIR_DATA(pair.id,b1),fetchPolicy:'cache-first'});case 5:newData=_context12.sent;oneDayHistory=newData.data.pairs[0];case 7:twoDayHistory=twoDayData===null||twoDayData===void 0?void 0:twoDayData[pair.id];if(twoDayHistory){_context12.next=13;break;}_context12.next=11;return client.query({query:PAIR_DATA(pair.id,b2),fetchPolicy:'cache-first'});case 11:_newData=_context12.sent;twoDayHistory=_newData.data.pairs[0];case 13:oneWeekHistory=oneWeekData===null||oneWeekData===void 0?void 0:oneWeekData[pair.id];if(oneWeekHistory){_context12.next=19;break;}_context12.next=17;return client.query({query:PAIR_DATA(pair.id,bWeek),fetchPolicy:'cache-first'});case 17:_newData2=_context12.sent;oneWeekHistory=_newData2.data.pairs[0];case 19:data=parseData(data,oneDayHistory,twoDayHistory,oneWeekHistory,ethPrice,b1);return _context12.abrupt(\"return\",data);case 21:case\"end\":return _context12.stop();}}},_callee12);}));return function(_x10){return _ref8.apply(this,arguments);};}()));case 24:pairData=_context13.sent;return _context13.abrupt(\"return\",pairData);case 28:_context13.prev=28;_context13.t0=_context13[\"catch\"](8);console.log(_context13.t0);case 31:case\"end\":return _context13.stop();}}},_callee13,null,[[8,28]]);}));return _getBulkPairData.apply(this,arguments);}function parseData(data,oneDayData,twoDayData,oneWeekData,ethPrice,oneDayBlock){// get volume changes\nvar _get2DayPercentChange=get2DayPercentChange(data===null||data===void 0?void 0:data.volumeUSD,(oneDayData===null||oneDayData===void 0?void 0:oneDayData.volumeUSD)?oneDayData.volumeUSD:0,(twoDayData===null||twoDayData===void 0?void 0:twoDayData.volumeUSD)?twoDayData.volumeUSD:0),_get2DayPercentChange2=_slicedToArray(_get2DayPercentChange,2),oneDayVolumeUSD=_get2DayPercentChange2[0],volumeChangeUSD=_get2DayPercentChange2[1];var _get2DayPercentChange3=get2DayPercentChange(data===null||data===void 0?void 0:data.untrackedVolumeUSD,(oneDayData===null||oneDayData===void 0?void 0:oneDayData.untrackedVolumeUSD)?parseFloat(oneDayData===null||oneDayData===void 0?void 0:oneDayData.untrackedVolumeUSD):0,(twoDayData===null||twoDayData===void 0?void 0:twoDayData.untrackedVolumeUSD)?twoDayData===null||twoDayData===void 0?void 0:twoDayData.untrackedVolumeUSD:0),_get2DayPercentChange4=_slicedToArray(_get2DayPercentChange3,2),oneDayVolumeUntracked=_get2DayPercentChange4[0],volumeChangeUntracked=_get2DayPercentChange4[1];var oneWeekVolumeUSD=parseFloat(oneWeekData?(data===null||data===void 0?void 0:data.volumeUSD)-(oneWeekData===null||oneWeekData===void 0?void 0:oneWeekData.volumeUSD):data.volumeUSD);// set volume properties\ndata.oneDayVolumeUSD=parseFloat(oneDayVolumeUSD);data.oneWeekVolumeUSD=oneWeekVolumeUSD;data.volumeChangeUSD=volumeChangeUSD;data.oneDayVolumeUntracked=oneDayVolumeUntracked;data.volumeChangeUntracked=volumeChangeUntracked;// set liquiditry properties\ndata.trackedReserveUSD=data.trackedReserveETH*ethPrice;data.liquidityChangeUSD=getPercentChange(data.reserveUSD,oneDayData===null||oneDayData===void 0?void 0:oneDayData.reserveUSD);// format if pair hasnt existed for a day or a week\nif(!oneDayData&&data&&data.createdAtBlockNumber>oneDayBlock){data.oneDayVolumeUSD=parseFloat(data.volumeUSD);}if(!oneDayData&&data){data.oneDayVolumeUSD=parseFloat(data.volumeUSD);}if(!oneWeekData&&data){data.oneWeekVolumeUSD=parseFloat(data.volumeUSD);}// format incorrect names\nupdateNameData(data);return data;}var getPairTransactions=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(pairAddress){var transactions,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:transactions={};_context.prev=1;_context.next=4;return client.query({query:FILTERED_TRANSACTIONS,variables:{allPairs:[pairAddress]},fetchPolicy:'no-cache'});case 4:result=_context.sent;transactions.mints=result.data.mints;transactions.burns=result.data.burns;transactions.swaps=result.data.swaps;_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 13:return _context.abrupt(\"return\",transactions);case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return function getPairTransactions(_x3){return _ref3.apply(this,arguments);};}();var getPairChartData=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(pairAddress){var data,utcEndTime,utcStartTime,startTime,allFound,skip,result,dayIndexSet,dayIndexArray,oneDay,timestamp,latestLiquidityUSD,index,nextDay,currentDayIndex;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:data=[];utcEndTime=dayjs.utc();utcStartTime=utcEndTime.subtract(1,'year').startOf('minute');startTime=utcStartTime.unix()-1;_context2.prev=4;allFound=false;skip=0;case 7:if(allFound){_context2.next=16;break;}_context2.next=10;return client.query({query:PAIR_CHART,variables:{pairAddress:pairAddress,skip:skip},fetchPolicy:'cache-first'});case 10:result=_context2.sent;skip+=1000;data=data.concat(result.data.pairDayDatas);if(result.data.pairDayDatas.length<1000){allFound=true;}_context2.next=7;break;case 16:dayIndexSet=new Set();dayIndexArray=[];oneDay=24*60*60;data.forEach(function(dayData,i){// add the day index to the set of days\ndayIndexSet.add((data[i].date/oneDay).toFixed(0));dayIndexArray.push(data[i]);dayData.dailyVolumeUSD=parseFloat(dayData.dailyVolumeUSD);dayData.reserveUSD=parseFloat(dayData.reserveUSD);});if(data[0]){// fill in empty days\ntimestamp=data[0].date?data[0].date:startTime;latestLiquidityUSD=data[0].reserveUSD;index=1;while(timestamp<utcEndTime.unix()-oneDay){nextDay=timestamp+oneDay;currentDayIndex=(nextDay/oneDay).toFixed(0);if(!dayIndexSet.has(currentDayIndex)){data.push({date:nextDay,dayString:nextDay,dailyVolumeUSD:0,reserveUSD:latestLiquidityUSD});}else{latestLiquidityUSD=dayIndexArray[index].reserveUSD;index=index+1;}timestamp=nextDay;}}data=data.sort(function(a,b){return parseInt(a.date)>parseInt(b.date)?1:-1;});_context2.next=27;break;case 24:_context2.prev=24;_context2.t0=_context2[\"catch\"](4);console.log(_context2.t0);case 27:return _context2.abrupt(\"return\",data);case 28:case\"end\":return _context2.stop();}}},_callee2,null,[[4,24]]);}));return function getPairChartData(_x4){return _ref4.apply(this,arguments);};}();var getHourlyRateData=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(pairAddress,startTime,latestBlock){var _blocks,utcEndTime,time,timestamps,blocks,result,values,row,timestamp,_result$row,_result$row2,formattedHistoryRate0,formattedHistoryRate1,i;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;utcEndTime=dayjs.utc();time=startTime;// create an array of hour start times until we reach current hour\ntimestamps=[];while(time<=utcEndTime.unix()-3600){timestamps.push(time);time+=3600;}// backout if invalid timestamp format\nif(!(timestamps.length===0)){_context3.next=7;break;}return _context3.abrupt(\"return\",[]);case 7:_context3.next=9;return getBlocksFromTimestamps(timestamps,100);case 9:blocks=_context3.sent;if(!(!blocks||((_blocks=blocks)===null||_blocks===void 0?void 0:_blocks.length)===0)){_context3.next=12;break;}return _context3.abrupt(\"return\",[]);case 12:if(latestBlock){blocks=blocks.filter(function(b){return parseFloat(b.number)<=parseFloat(latestBlock);});}_context3.next=15;return splitQuery(HOURLY_PAIR_RATES,client,[pairAddress],blocks,100);case 15:result=_context3.sent;// format token ETH price results\nvalues=[];for(row in result){timestamp=row.split('t')[1];if(timestamp){values.push({timestamp:timestamp,rate0:parseFloat((_result$row=result[row])===null||_result$row===void 0?void 0:_result$row.token0Price),rate1:parseFloat((_result$row2=result[row])===null||_result$row2===void 0?void 0:_result$row2.token1Price)});}}formattedHistoryRate0=[];formattedHistoryRate1=[];// for each hour, construct the open and close price\nfor(i=0;i<values.length-1;i++){formattedHistoryRate0.push({timestamp:values[i].timestamp,open:parseFloat(values[i].rate0),close:parseFloat(values[i+1].rate0)});formattedHistoryRate1.push({timestamp:values[i].timestamp,open:parseFloat(values[i].rate1),close:parseFloat(values[i+1].rate1)});}return _context3.abrupt(\"return\",[formattedHistoryRate0,formattedHistoryRate1]);case 24:_context3.prev=24;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);return _context3.abrupt(\"return\",[[],[]]);case 28:case\"end\":return _context3.stop();}}},_callee3,null,[[0,24]]);}));return function getHourlyRateData(_x5,_x6,_x7){return _ref5.apply(this,arguments);};}();export function Updater(){var _usePairDataContext=usePairDataContext(),_usePairDataContext2=_slicedToArray(_usePairDataContext,2),updateTopPairs=_usePairDataContext2[1].updateTopPairs;var _useEthPrice=useEthPrice(),_useEthPrice2=_slicedToArray(_useEthPrice,1),ethPrice=_useEthPrice2[0];useEffect(function(){function getData(){return _getData.apply(this,arguments);}function _getData(){_getData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var _yield$client$query,pairs,formattedPairs,topPairs;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return client.query({query:PAIRS_CURRENT,fetchPolicy:'cache-first'});case 2:_yield$client$query=_context4.sent;pairs=_yield$client$query.data.pairs;// format as array of addresses\nformattedPairs=pairs.map(function(pair){return pair.id;});// get data for every pair in list\n_context4.next=7;return getBulkPairData(formattedPairs,ethPrice);case 7:topPairs=_context4.sent;topPairs&&updateTopPairs(topPairs);case 9:case\"end\":return _context4.stop();}}},_callee4);}));return _getData.apply(this,arguments);}ethPrice&&getData();},[ethPrice,updateTopPairs]);return null;}export function useHourlyRateData(pairAddress,timeWindow){var _state$pairAddress,_state$pairAddress$ho;var _usePairDataContext3=usePairDataContext(),_usePairDataContext4=_slicedToArray(_usePairDataContext3,2),state=_usePairDataContext4[0],updateHourlyData=_usePairDataContext4[1].updateHourlyData;var chartData=state===null||state===void 0?void 0:(_state$pairAddress=state[pairAddress])===null||_state$pairAddress===void 0?void 0:(_state$pairAddress$ho=_state$pairAddress.hourlyData)===null||_state$pairAddress$ho===void 0?void 0:_state$pairAddress$ho[timeWindow];var _useLatestBlocks=useLatestBlocks(),_useLatestBlocks2=_slicedToArray(_useLatestBlocks,1),latestBlock=_useLatestBlocks2[0];useEffect(function(){var currentTime=dayjs.utc();var windowSize=timeWindow===timeframeOptions.MONTH?'month':'week';var startTime=timeWindow===timeframeOptions.ALL_TIME?1589760000:currentTime.subtract(1,windowSize).startOf('hour').unix();function fetch(){return _fetch.apply(this,arguments);}function _fetch(){_fetch=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var data;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return getHourlyRateData(pairAddress,startTime,latestBlock);case 2:data=_context5.sent;updateHourlyData(pairAddress,data,timeWindow);case 4:case\"end\":return _context5.stop();}}},_callee5);}));return _fetch.apply(this,arguments);}if(!chartData){fetch();}},[chartData,timeWindow,pairAddress,updateHourlyData,latestBlock]);return chartData;}/**\n * @todo\n * store these updates to reduce future redundant calls\n */export function useDataForList(pairList){var _usePairDataContext5=usePairDataContext(),_usePairDataContext6=_slicedToArray(_usePairDataContext5,1),state=_usePairDataContext6[0];var _useEthPrice3=useEthPrice(),_useEthPrice4=_slicedToArray(_useEthPrice3,1),ethPrice=_useEthPrice4[0];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),stale=_useState2[0],setStale=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),fetched=_useState4[0],setFetched=_useState4[1];// reset\nuseEffect(function(){if(pairList){setStale(false);setFetched();}},[pairList]);useEffect(function(){function fetchNewPairData(){return _fetchNewPairData.apply(this,arguments);}function _fetchNewPairData(){_fetchNewPairData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var newFetched,unfetched,newPairData;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:newFetched=[];unfetched=[];pairList.map(/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(pair){var currentData;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:currentData=state===null||state===void 0?void 0:state[pair.id];if(!currentData){unfetched.push(pair.id);}else{newFetched.push(currentData);}case 2:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x8){return _ref6.apply(this,arguments);};}());_context7.next=5;return getBulkPairData(unfetched.map(function(pair){return pair;}),ethPrice);case 5:newPairData=_context7.sent;setFetched(newFetched.concat(newPairData));case 7:case\"end\":return _context7.stop();}}},_callee7);}));return _fetchNewPairData.apply(this,arguments);}if(ethPrice&&pairList&&pairList.length>0&&!fetched&&!stale){setStale(true);fetchNewPairData();}},[ethPrice,state,pairList,stale,fetched]);var formattedFetch=fetched&&fetched.reduce(function(obj,cur){return _objectSpread(_objectSpread({},obj),{},_defineProperty({},cur===null||cur===void 0?void 0:cur.id,cur));},{});return formattedFetch;}/**\n * Get all the current and 24hr changes for a pair\n */export function usePairData(pairAddress){var _usePairDataContext7=usePairDataContext(),_usePairDataContext8=_slicedToArray(_usePairDataContext7,2),state=_usePairDataContext8[0],update=_usePairDataContext8[1].update;var _useEthPrice5=useEthPrice(),_useEthPrice6=_slicedToArray(_useEthPrice5,1),ethPrice=_useEthPrice6[0];var pairData=state===null||state===void 0?void 0:state[pairAddress];useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var data;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:if(!(!pairData&&pairAddress)){_context8.next=5;break;}_context8.next=3;return getBulkPairData([pairAddress],ethPrice);case 3:data=_context8.sent;data&&update(pairAddress,data[0]);case 5:case\"end\":return _context8.stop();}}},_callee8);}));return _fetchData.apply(this,arguments);}if(!pairData&&pairAddress&&ethPrice&&isAddress(pairAddress)){fetchData();}},[pairAddress,pairData,update,ethPrice]);return pairData||{};}/**\n * Get most recent txns for a pair\n */export function usePairTransactions(pairAddress){var _state$pairAddress2;var _usePairDataContext9=usePairDataContext(),_usePairDataContext10=_slicedToArray(_usePairDataContext9,2),state=_usePairDataContext10[0],updatePairTxns=_usePairDataContext10[1].updatePairTxns;var pairTxns=state===null||state===void 0?void 0:(_state$pairAddress2=state[pairAddress])===null||_state$pairAddress2===void 0?void 0:_state$pairAddress2.txns;useEffect(function(){function checkForTxns(){return _checkForTxns.apply(this,arguments);}function _checkForTxns(){_checkForTxns=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var transactions;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:if(pairTxns){_context9.next=5;break;}_context9.next=3;return getPairTransactions(pairAddress);case 3:transactions=_context9.sent;updatePairTxns(pairAddress,transactions);case 5:case\"end\":return _context9.stop();}}},_callee9);}));return _checkForTxns.apply(this,arguments);}checkForTxns();},[pairTxns,pairAddress,updatePairTxns]);return pairTxns;}export function usePairChartData(pairAddress){var _state$pairAddress3;var _usePairDataContext11=usePairDataContext(),_usePairDataContext12=_slicedToArray(_usePairDataContext11,2),state=_usePairDataContext12[0],updateChartData=_usePairDataContext12[1].updateChartData;var chartData=state===null||state===void 0?void 0:(_state$pairAddress3=state[pairAddress])===null||_state$pairAddress3===void 0?void 0:_state$pairAddress3.chartData;useEffect(function(){function checkForChartData(){return _checkForChartData.apply(this,arguments);}function _checkForChartData(){_checkForChartData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){var data;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:if(chartData){_context10.next=5;break;}_context10.next=3;return getPairChartData(pairAddress);case 3:data=_context10.sent;updateChartData(pairAddress,data);case 5:case\"end\":return _context10.stop();}}},_callee10);}));return _checkForChartData.apply(this,arguments);}checkForChartData();},[chartData,pairAddress,updateChartData]);return chartData;}/**\n * Get list of all pairs in Uniswap\n */export function useAllPairData(){var _usePairDataContext13=usePairDataContext(),_usePairDataContext14=_slicedToArray(_usePairDataContext13,1),state=_usePairDataContext14[0];return state||{};}","map":{"version":3,"sources":["/Users/macbook/Desktop/juiceswap/juiceswap-docs/src/contexts/PairData.js"],"names":["React","createContext","useContext","useReducer","useMemo","useCallback","useEffect","useState","client","PAIR_DATA","PAIR_CHART","FILTERED_TRANSACTIONS","PAIRS_CURRENT","PAIRS_BULK","PAIRS_HISTORICAL_BULK","HOURLY_PAIR_RATES","useEthPrice","dayjs","utc","getPercentChange","get2DayPercentChange","isAddress","getBlocksFromTimestamps","getTimestampsForChanges","splitQuery","timeframeOptions","useLatestBlocks","updateNameData","UPDATE","UPDATE_PAIR_TXNS","UPDATE_CHART_DATA","UPDATE_TOP_PAIRS","UPDATE_HOURLY_DATA","extend","safeAccess","object","path","reduce","accumulator","currentValue","PairDataContext","usePairDataContext","reducer","state","type","payload","pairAddress","data","topPairs","added","map","pair","id","address","transactions","txns","chartData","hourlyData","timeWindow","Error","Provider","children","dispatch","update","updateTopPairs","updatePairTxns","updateChartData","updateHourlyData","getBulkPairData","pairList","ethPrice","t1","t2","tWeek","b1","number","b2","bWeek","query","variables","allPairs","fetchPolicy","current","Promise","all","block","result","oneDayResult","twoDayResult","oneWeekResult","oneDayData","pairs","obj","cur","i","twoDayData","oneWeekData","oneDayHistory","newData","twoDayHistory","oneWeekHistory","parseData","pairData","console","log","oneDayBlock","volumeUSD","oneDayVolumeUSD","volumeChangeUSD","untrackedVolumeUSD","parseFloat","oneDayVolumeUntracked","volumeChangeUntracked","oneWeekVolumeUSD","trackedReserveUSD","trackedReserveETH","liquidityChangeUSD","reserveUSD","createdAtBlockNumber","getPairTransactions","mints","burns","swaps","getPairChartData","utcEndTime","utcStartTime","subtract","startOf","startTime","unix","allFound","skip","concat","pairDayDatas","length","dayIndexSet","Set","dayIndexArray","oneDay","forEach","dayData","add","date","toFixed","push","dailyVolumeUSD","timestamp","latestLiquidityUSD","index","nextDay","currentDayIndex","has","dayString","sort","a","b","parseInt","getHourlyRateData","latestBlock","time","timestamps","blocks","filter","values","row","split","rate0","token0Price","rate1","token1Price","formattedHistoryRate0","formattedHistoryRate1","open","close","Updater","getData","formattedPairs","useHourlyRateData","currentTime","windowSize","MONTH","ALL_TIME","fetch","useDataForList","stale","setStale","fetched","setFetched","fetchNewPairData","newFetched","unfetched","currentData","newPairData","formattedFetch","usePairData","fetchData","usePairTransactions","pairTxns","checkForTxns","usePairChartData","checkForChartData","useAllPairData"],"mappings":"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","sourcesContent":["import React, { createContext, useContext, useReducer, useMemo, useCallback, useEffect, useState } from 'react'\n\nimport { client } from '../apollo/client'\nimport {\n  PAIR_DATA,\n  PAIR_CHART,\n  FILTERED_TRANSACTIONS,\n  PAIRS_CURRENT,\n  PAIRS_BULK,\n  PAIRS_HISTORICAL_BULK,\n  HOURLY_PAIR_RATES,\n} from '../apollo/queries'\n\nimport { useEthPrice } from './GlobalData'\n\nimport dayjs from 'dayjs'\nimport utc from 'dayjs/plugin/utc'\n\nimport {\n  getPercentChange,\n  get2DayPercentChange,\n  isAddress,\n  getBlocksFromTimestamps,\n  getTimestampsForChanges,\n  splitQuery,\n} from '../utils'\nimport { timeframeOptions } from '../constants'\nimport { useLatestBlocks } from './Application'\nimport { updateNameData } from '../utils/data'\n\nconst UPDATE = 'UPDATE'\nconst UPDATE_PAIR_TXNS = 'UPDATE_PAIR_TXNS'\nconst UPDATE_CHART_DATA = 'UPDATE_CHART_DATA'\nconst UPDATE_TOP_PAIRS = 'UPDATE_TOP_PAIRS'\nconst UPDATE_HOURLY_DATA = 'UPDATE_HOURLY_DATA'\n\ndayjs.extend(utc)\n\nexport function safeAccess(object, path) {\n  return object\n    ? path.reduce(\n        (accumulator, currentValue) => (accumulator && accumulator[currentValue] ? accumulator[currentValue] : null),\n        object\n      )\n    : null\n}\n\nconst PairDataContext = createContext()\n\nfunction usePairDataContext() {\n  return useContext(PairDataContext)\n}\n\nfunction reducer(state, { type, payload }) {\n  switch (type) {\n    case UPDATE: {\n      const { pairAddress, data } = payload\n      return {\n        ...state,\n        [pairAddress]: {\n          ...state?.[pairAddress],\n          ...data,\n        },\n      }\n    }\n\n    case UPDATE_TOP_PAIRS: {\n      const { topPairs } = payload\n      let added = {}\n      topPairs.map((pair) => {\n        return (added[pair.id] = pair)\n      })\n      return {\n        ...state,\n        ...added,\n      }\n    }\n\n    case UPDATE_PAIR_TXNS: {\n      const { address, transactions } = payload\n      return {\n        ...state,\n        [address]: {\n          ...(safeAccess(state, [address]) || {}),\n          txns: transactions,\n        },\n      }\n    }\n    case UPDATE_CHART_DATA: {\n      const { address, chartData } = payload\n      return {\n        ...state,\n        [address]: {\n          ...(safeAccess(state, [address]) || {}),\n          chartData,\n        },\n      }\n    }\n\n    case UPDATE_HOURLY_DATA: {\n      const { address, hourlyData, timeWindow } = payload\n      return {\n        ...state,\n        [address]: {\n          ...state?.[address],\n          hourlyData: {\n            ...state?.[address]?.hourlyData,\n            [timeWindow]: hourlyData,\n          },\n        },\n      }\n    }\n\n    default: {\n      throw Error(`Unexpected action type in DataContext reducer: '${type}'.`)\n    }\n  }\n}\n\nexport default function Provider({ children }) {\n  const [state, dispatch] = useReducer(reducer, {})\n\n  // update pair specific data\n  const update = useCallback((pairAddress, data) => {\n    dispatch({\n      type: UPDATE,\n      payload: {\n        pairAddress,\n        data,\n      },\n    })\n  }, [])\n\n  const updateTopPairs = useCallback((topPairs) => {\n    dispatch({\n      type: UPDATE_TOP_PAIRS,\n      payload: {\n        topPairs,\n      },\n    })\n  }, [])\n\n  const updatePairTxns = useCallback((address, transactions) => {\n    dispatch({\n      type: UPDATE_PAIR_TXNS,\n      payload: { address, transactions },\n    })\n  }, [])\n\n  const updateChartData = useCallback((address, chartData) => {\n    dispatch({\n      type: UPDATE_CHART_DATA,\n      payload: { address, chartData },\n    })\n  }, [])\n\n  const updateHourlyData = useCallback((address, hourlyData, timeWindow) => {\n    dispatch({\n      type: UPDATE_HOURLY_DATA,\n      payload: { address, hourlyData, timeWindow },\n    })\n  }, [])\n\n  return (\n    <PairDataContext.Provider\n      value={useMemo(\n        () => [\n          state,\n          {\n            update,\n            updatePairTxns,\n            updateChartData,\n            updateTopPairs,\n            updateHourlyData,\n          },\n        ],\n        [state, update, updatePairTxns, updateChartData, updateTopPairs, updateHourlyData]\n      )}\n    >\n      {children}\n    </PairDataContext.Provider>\n  )\n}\n\nasync function getBulkPairData(pairList, ethPrice) {\n  const [t1, t2, tWeek] = getTimestampsForChanges()\n  let [{ number: b1 }, { number: b2 }, { number: bWeek }] = await getBlocksFromTimestamps([t1, t2, tWeek])\n\n  try {\n    let current = await client.query({\n      query: PAIRS_BULK,\n      variables: {\n        allPairs: pairList,\n      },\n      fetchPolicy: 'cache-first',\n    })\n\n    let [oneDayResult, twoDayResult, oneWeekResult] = await Promise.all(\n      [b1, b2, bWeek].map(async (block) => {\n        let result = client.query({\n          query: PAIRS_HISTORICAL_BULK(block, pairList),\n          fetchPolicy: 'cache-first',\n        })\n        return result\n      })\n    )\n\n    let oneDayData = oneDayResult?.data?.pairs.reduce((obj, cur, i) => {\n      return { ...obj, [cur.id]: cur }\n    }, {})\n\n    let twoDayData = twoDayResult?.data?.pairs.reduce((obj, cur, i) => {\n      return { ...obj, [cur.id]: cur }\n    }, {})\n\n    let oneWeekData = oneWeekResult?.data?.pairs.reduce((obj, cur, i) => {\n      return { ...obj, [cur.id]: cur }\n    }, {})\n\n    let pairData = await Promise.all(\n      current &&\n        current.data.pairs.map(async (pair) => {\n          let data = pair\n          let oneDayHistory = oneDayData?.[pair.id]\n          if (!oneDayHistory) {\n            let newData = await client.query({\n              query: PAIR_DATA(pair.id, b1),\n              fetchPolicy: 'cache-first',\n            })\n            oneDayHistory = newData.data.pairs[0]\n          }\n          let twoDayHistory = twoDayData?.[pair.id]\n          if (!twoDayHistory) {\n            let newData = await client.query({\n              query: PAIR_DATA(pair.id, b2),\n              fetchPolicy: 'cache-first',\n            })\n            twoDayHistory = newData.data.pairs[0]\n          }\n          let oneWeekHistory = oneWeekData?.[pair.id]\n          if (!oneWeekHistory) {\n            let newData = await client.query({\n              query: PAIR_DATA(pair.id, bWeek),\n              fetchPolicy: 'cache-first',\n            })\n            oneWeekHistory = newData.data.pairs[0]\n          }\n          data = parseData(data, oneDayHistory, twoDayHistory, oneWeekHistory, ethPrice, b1)\n          return data\n        })\n    )\n    return pairData\n  } catch (e) {\n    console.log(e)\n  }\n}\n\nfunction parseData(data, oneDayData, twoDayData, oneWeekData, ethPrice, oneDayBlock) {\n  // get volume changes\n  const [oneDayVolumeUSD, volumeChangeUSD] = get2DayPercentChange(\n    data?.volumeUSD,\n    oneDayData?.volumeUSD ? oneDayData.volumeUSD : 0,\n    twoDayData?.volumeUSD ? twoDayData.volumeUSD : 0\n  )\n  const [oneDayVolumeUntracked, volumeChangeUntracked] = get2DayPercentChange(\n    data?.untrackedVolumeUSD,\n    oneDayData?.untrackedVolumeUSD ? parseFloat(oneDayData?.untrackedVolumeUSD) : 0,\n    twoDayData?.untrackedVolumeUSD ? twoDayData?.untrackedVolumeUSD : 0\n  )\n  const oneWeekVolumeUSD = parseFloat(oneWeekData ? data?.volumeUSD - oneWeekData?.volumeUSD : data.volumeUSD)\n\n  // set volume properties\n  data.oneDayVolumeUSD = parseFloat(oneDayVolumeUSD)\n  data.oneWeekVolumeUSD = oneWeekVolumeUSD\n  data.volumeChangeUSD = volumeChangeUSD\n  data.oneDayVolumeUntracked = oneDayVolumeUntracked\n  data.volumeChangeUntracked = volumeChangeUntracked\n\n  // set liquiditry properties\n  data.trackedReserveUSD = data.trackedReserveETH * ethPrice\n  data.liquidityChangeUSD = getPercentChange(data.reserveUSD, oneDayData?.reserveUSD)\n\n  // format if pair hasnt existed for a day or a week\n  if (!oneDayData && data && data.createdAtBlockNumber > oneDayBlock) {\n    data.oneDayVolumeUSD = parseFloat(data.volumeUSD)\n  }\n  if (!oneDayData && data) {\n    data.oneDayVolumeUSD = parseFloat(data.volumeUSD)\n  }\n  if (!oneWeekData && data) {\n    data.oneWeekVolumeUSD = parseFloat(data.volumeUSD)\n  }\n\n  // format incorrect names\n  updateNameData(data)\n\n  return data\n}\n\nconst getPairTransactions = async (pairAddress) => {\n  const transactions = {}\n\n  try {\n    let result = await client.query({\n      query: FILTERED_TRANSACTIONS,\n      variables: {\n        allPairs: [pairAddress],\n      },\n      fetchPolicy: 'no-cache',\n    })\n    transactions.mints = result.data.mints\n    transactions.burns = result.data.burns\n    transactions.swaps = result.data.swaps\n  } catch (e) {\n    console.log(e)\n  }\n\n  return transactions\n}\n\nconst getPairChartData = async (pairAddress) => {\n  let data = []\n  const utcEndTime = dayjs.utc()\n  let utcStartTime = utcEndTime.subtract(1, 'year').startOf('minute')\n  let startTime = utcStartTime.unix() - 1\n\n  try {\n    let allFound = false\n    let skip = 0\n    while (!allFound) {\n      let result = await client.query({\n        query: PAIR_CHART,\n        variables: {\n          pairAddress: pairAddress,\n          skip,\n        },\n        fetchPolicy: 'cache-first',\n      })\n      skip += 1000\n      data = data.concat(result.data.pairDayDatas)\n      if (result.data.pairDayDatas.length < 1000) {\n        allFound = true\n      }\n    }\n\n    let dayIndexSet = new Set()\n    let dayIndexArray = []\n    const oneDay = 24 * 60 * 60\n    data.forEach((dayData, i) => {\n      // add the day index to the set of days\n      dayIndexSet.add((data[i].date / oneDay).toFixed(0))\n      dayIndexArray.push(data[i])\n      dayData.dailyVolumeUSD = parseFloat(dayData.dailyVolumeUSD)\n      dayData.reserveUSD = parseFloat(dayData.reserveUSD)\n    })\n\n    if (data[0]) {\n      // fill in empty days\n      let timestamp = data[0].date ? data[0].date : startTime\n      let latestLiquidityUSD = data[0].reserveUSD\n      let index = 1\n      while (timestamp < utcEndTime.unix() - oneDay) {\n        const nextDay = timestamp + oneDay\n        let currentDayIndex = (nextDay / oneDay).toFixed(0)\n        if (!dayIndexSet.has(currentDayIndex)) {\n          data.push({\n            date: nextDay,\n            dayString: nextDay,\n            dailyVolumeUSD: 0,\n            reserveUSD: latestLiquidityUSD,\n          })\n        } else {\n          latestLiquidityUSD = dayIndexArray[index].reserveUSD\n          index = index + 1\n        }\n        timestamp = nextDay\n      }\n    }\n\n    data = data.sort((a, b) => (parseInt(a.date) > parseInt(b.date) ? 1 : -1))\n  } catch (e) {\n    console.log(e)\n  }\n\n  return data\n}\n\nconst getHourlyRateData = async (pairAddress, startTime, latestBlock) => {\n  try {\n    const utcEndTime = dayjs.utc()\n    let time = startTime\n\n    // create an array of hour start times until we reach current hour\n    const timestamps = []\n    while (time <= utcEndTime.unix() - 3600) {\n      timestamps.push(time)\n      time += 3600\n    }\n\n    // backout if invalid timestamp format\n    if (timestamps.length === 0) {\n      return []\n    }\n\n    // once you have all the timestamps, get the blocks for each timestamp in a bulk query\n    let blocks\n\n    blocks = await getBlocksFromTimestamps(timestamps, 100)\n\n    // catch failing case\n    if (!blocks || blocks?.length === 0) {\n      return []\n    }\n\n    if (latestBlock) {\n      blocks = blocks.filter((b) => {\n        return parseFloat(b.number) <= parseFloat(latestBlock)\n      })\n    }\n\n    const result = await splitQuery(HOURLY_PAIR_RATES, client, [pairAddress], blocks, 100)\n\n    // format token ETH price results\n    let values = []\n    for (var row in result) {\n      let timestamp = row.split('t')[1]\n      if (timestamp) {\n        values.push({\n          timestamp,\n          rate0: parseFloat(result[row]?.token0Price),\n          rate1: parseFloat(result[row]?.token1Price),\n        })\n      }\n    }\n\n    let formattedHistoryRate0 = []\n    let formattedHistoryRate1 = []\n\n    // for each hour, construct the open and close price\n    for (let i = 0; i < values.length - 1; i++) {\n      formattedHistoryRate0.push({\n        timestamp: values[i].timestamp,\n        open: parseFloat(values[i].rate0),\n        close: parseFloat(values[i + 1].rate0),\n      })\n      formattedHistoryRate1.push({\n        timestamp: values[i].timestamp,\n        open: parseFloat(values[i].rate1),\n        close: parseFloat(values[i + 1].rate1),\n      })\n    }\n\n    return [formattedHistoryRate0, formattedHistoryRate1]\n  } catch (e) {\n    console.log(e)\n    return [[], []]\n  }\n}\n\nexport function Updater() {\n  const [, { updateTopPairs }] = usePairDataContext()\n  const [ethPrice] = useEthPrice()\n  useEffect(() => {\n    async function getData() {\n      // get top pairs by reserves\n      let {\n        data: { pairs },\n      } = await client.query({\n        query: PAIRS_CURRENT,\n        fetchPolicy: 'cache-first',\n      })\n\n      // format as array of addresses\n      const formattedPairs = pairs.map((pair) => {\n        return pair.id\n      })\n\n      // get data for every pair in list\n      let topPairs = await getBulkPairData(formattedPairs, ethPrice)\n      topPairs && updateTopPairs(topPairs)\n    }\n    ethPrice && getData()\n  }, [ethPrice, updateTopPairs])\n  return null\n}\n\nexport function useHourlyRateData(pairAddress, timeWindow) {\n  const [state, { updateHourlyData }] = usePairDataContext()\n  const chartData = state?.[pairAddress]?.hourlyData?.[timeWindow]\n  const [latestBlock] = useLatestBlocks()\n\n  useEffect(() => {\n    const currentTime = dayjs.utc()\n    const windowSize = timeWindow === timeframeOptions.MONTH ? 'month' : 'week'\n    const startTime =\n      timeWindow === timeframeOptions.ALL_TIME ? 1589760000 : currentTime.subtract(1, windowSize).startOf('hour').unix()\n\n    async function fetch() {\n      let data = await getHourlyRateData(pairAddress, startTime, latestBlock)\n      updateHourlyData(pairAddress, data, timeWindow)\n    }\n    if (!chartData) {\n      fetch()\n    }\n  }, [chartData, timeWindow, pairAddress, updateHourlyData, latestBlock])\n\n  return chartData\n}\n\n/**\n * @todo\n * store these updates to reduce future redundant calls\n */\nexport function useDataForList(pairList) {\n  const [state] = usePairDataContext()\n  const [ethPrice] = useEthPrice()\n\n  const [stale, setStale] = useState(false)\n  const [fetched, setFetched] = useState([])\n\n  // reset\n  useEffect(() => {\n    if (pairList) {\n      setStale(false)\n      setFetched()\n    }\n  }, [pairList])\n\n  useEffect(() => {\n    async function fetchNewPairData() {\n      let newFetched = []\n      let unfetched = []\n\n      pairList.map(async (pair) => {\n        let currentData = state?.[pair.id]\n        if (!currentData) {\n          unfetched.push(pair.id)\n        } else {\n          newFetched.push(currentData)\n        }\n      })\n\n      let newPairData = await getBulkPairData(\n        unfetched.map((pair) => {\n          return pair\n        }),\n        ethPrice\n      )\n      setFetched(newFetched.concat(newPairData))\n    }\n    if (ethPrice && pairList && pairList.length > 0 && !fetched && !stale) {\n      setStale(true)\n      fetchNewPairData()\n    }\n  }, [ethPrice, state, pairList, stale, fetched])\n\n  let formattedFetch =\n    fetched &&\n    fetched.reduce((obj, cur) => {\n      return { ...obj, [cur?.id]: cur }\n    }, {})\n\n  return formattedFetch\n}\n\n/**\n * Get all the current and 24hr changes for a pair\n */\nexport function usePairData(pairAddress) {\n  const [state, { update }] = usePairDataContext()\n  const [ethPrice] = useEthPrice()\n  const pairData = state?.[pairAddress]\n\n  useEffect(() => {\n    async function fetchData() {\n      if (!pairData && pairAddress) {\n        let data = await getBulkPairData([pairAddress], ethPrice)\n        data && update(pairAddress, data[0])\n      }\n    }\n    if (!pairData && pairAddress && ethPrice && isAddress(pairAddress)) {\n      fetchData()\n    }\n  }, [pairAddress, pairData, update, ethPrice])\n\n  return pairData || {}\n}\n\n/**\n * Get most recent txns for a pair\n */\nexport function usePairTransactions(pairAddress) {\n  const [state, { updatePairTxns }] = usePairDataContext()\n  const pairTxns = state?.[pairAddress]?.txns\n  useEffect(() => {\n    async function checkForTxns() {\n      if (!pairTxns) {\n        let transactions = await getPairTransactions(pairAddress)\n        updatePairTxns(pairAddress, transactions)\n      }\n    }\n    checkForTxns()\n  }, [pairTxns, pairAddress, updatePairTxns])\n  return pairTxns\n}\n\nexport function usePairChartData(pairAddress) {\n  const [state, { updateChartData }] = usePairDataContext()\n  const chartData = state?.[pairAddress]?.chartData\n\n  useEffect(() => {\n    async function checkForChartData() {\n      if (!chartData) {\n        let data = await getPairChartData(pairAddress)\n        updateChartData(pairAddress, data)\n      }\n    }\n    checkForChartData()\n  }, [chartData, pairAddress, updateChartData])\n  return chartData\n}\n\n/**\n * Get list of all pairs in Uniswap\n */\nexport function useAllPairData() {\n  const [state] = usePairDataContext()\n  return state || {}\n}\n"]},"metadata":{},"sourceType":"module"}