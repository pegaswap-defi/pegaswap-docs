{"ast":null,"code":"var _jsxFileName = \"/Users/macbook/Desktop/Pega/pegaswap-docs/src/contexts/Application.js\";\nimport React, { createContext, useContext, useReducer, useMemo, useCallback, useState, useEffect } from 'react';\nimport { timeframeOptions, SUPPORTED_LIST_URLS__NO_ENS } from '../constants';\nimport dayjs from 'dayjs';\nimport utc from 'dayjs/plugin/utc';\nimport getTokenList from '../utils/tokenLists';\nimport { healthClient } from '../apollo/client';\nimport { SUBGRAPH_HEALTH } from '../apollo/queries';\ndayjs.extend(utc);\nconst UPDATE = 'UPDATE';\nconst UPDATE_TIMEFRAME = 'UPDATE_TIMEFRAME';\nconst UPDATE_SESSION_START = 'UPDATE_SESSION_START';\nconst UPDATED_SUPPORTED_TOKENS = 'UPDATED_SUPPORTED_TOKENS';\nconst UPDATE_LATEST_BLOCK = 'UPDATE_LATEST_BLOCK';\nconst UPDATE_HEAD_BLOCK = 'UPDATE_HEAD_BLOCK';\nconst SUPPORTED_TOKENS = 'SUPPORTED_TOKENS';\nconst TIME_KEY = 'TIME_KEY';\nconst CURRENCY = 'CURRENCY';\nconst SESSION_START = 'SESSION_START';\nconst LATEST_BLOCK = 'LATEST_BLOCK';\nconst HEAD_BLOCK = 'HEAD_BLOCK';\nconst ApplicationContext = createContext();\n\nfunction useApplicationContext() {\n  return useContext(ApplicationContext);\n}\n\nfunction reducer(state, {\n  type,\n  payload\n}) {\n  switch (type) {\n    case UPDATE:\n      {\n        const {\n          currency\n        } = payload;\n        return { ...state,\n          [CURRENCY]: currency\n        };\n      }\n\n    case UPDATE_TIMEFRAME:\n      {\n        const {\n          newTimeFrame\n        } = payload;\n        return { ...state,\n          [TIME_KEY]: newTimeFrame\n        };\n      }\n\n    case UPDATE_SESSION_START:\n      {\n        const {\n          timestamp\n        } = payload;\n        return { ...state,\n          [SESSION_START]: timestamp\n        };\n      }\n\n    case UPDATE_LATEST_BLOCK:\n      {\n        const {\n          block\n        } = payload;\n        return { ...state,\n          [LATEST_BLOCK]: block\n        };\n      }\n\n    case UPDATE_HEAD_BLOCK:\n      {\n        const {\n          block\n        } = payload;\n        return { ...state,\n          [HEAD_BLOCK]: block\n        };\n      }\n\n    case UPDATED_SUPPORTED_TOKENS:\n      {\n        const {\n          supportedTokens\n        } = payload;\n        return { ...state,\n          [SUPPORTED_TOKENS]: supportedTokens\n        };\n      }\n\n    default:\n      {\n        throw Error(`Unexpected action type in DataContext reducer: '${type}'.`);\n      }\n  }\n}\n\nconst INITIAL_STATE = {\n  CURRENCY: 'USD',\n  TIME_KEY: timeframeOptions.ALL_TIME\n};\nexport default function Provider({\n  children\n}) {\n  const [state, dispatch] = useReducer(reducer, INITIAL_STATE);\n  const update = useCallback(currency => {\n    dispatch({\n      type: UPDATE,\n      payload: {\n        currency\n      }\n    });\n  }, []); // global time window for charts - see timeframe options in constants\n\n  const updateTimeframe = useCallback(newTimeFrame => {\n    dispatch({\n      type: UPDATE_TIMEFRAME,\n      payload: {\n        newTimeFrame\n      }\n    });\n  }, []); // used for refresh button\n\n  const updateSessionStart = useCallback(timestamp => {\n    dispatch({\n      type: UPDATE_SESSION_START,\n      payload: {\n        timestamp\n      }\n    });\n  }, []);\n  const updateSupportedTokens = useCallback(supportedTokens => {\n    dispatch({\n      type: UPDATED_SUPPORTED_TOKENS,\n      payload: {\n        supportedTokens\n      }\n    });\n  }, []);\n  const updateLatestBlock = useCallback(block => {\n    dispatch({\n      type: UPDATE_LATEST_BLOCK,\n      payload: {\n        block\n      }\n    });\n  }, []);\n  const updateHeadBlock = useCallback(block => {\n    dispatch({\n      type: UPDATE_HEAD_BLOCK,\n      payload: {\n        block\n      }\n    });\n  }, []);\n  return /*#__PURE__*/React.createElement(ApplicationContext.Provider, {\n    value: useMemo(() => [state, {\n      update,\n      updateSessionStart,\n      updateTimeframe,\n      updateSupportedTokens,\n      updateLatestBlock,\n      updateHeadBlock\n    }], [state, update, updateTimeframe, updateSessionStart, updateSupportedTokens, updateLatestBlock, updateHeadBlock]),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 5\n    }\n  }, children);\n}\nexport function useLatestBlocks() {\n  const [state, {\n    updateLatestBlock,\n    updateHeadBlock\n  }] = useApplicationContext();\n  const latestBlock = state === null || state === void 0 ? void 0 : state[LATEST_BLOCK];\n  const headBlock = state === null || state === void 0 ? void 0 : state[HEAD_BLOCK];\n  useEffect(() => {\n    async function fetch() {\n      healthClient.query({\n        query: SUBGRAPH_HEALTH\n      }).then(res => {\n        const syncedBlock = res.data.indexingStatusForCurrentVersion.chains[0].latestBlock.number;\n        const headBlock = res.data.indexingStatusForCurrentVersion.chains[0].chainHeadBlock.number;\n\n        if (syncedBlock && headBlock) {\n          updateLatestBlock(syncedBlock);\n          updateHeadBlock(headBlock);\n        }\n      }).catch(e => {\n        console.log(e);\n      });\n    }\n\n    if (!latestBlock) {\n      fetch();\n    }\n  }, [latestBlock, updateHeadBlock, updateLatestBlock]);\n  return [latestBlock, headBlock];\n}\nexport function useCurrentCurrency() {\n  const [state, {\n    update\n  }] = useApplicationContext();\n  const toggleCurrency = useCallback(() => {\n    if (state.currency === 'ETH') {\n      update('USD');\n    } else {\n      update('ETH');\n    }\n  }, [state, update]);\n  return [state[CURRENCY], toggleCurrency];\n}\nexport function useTimeframe() {\n  const [state, {\n    updateTimeframe\n  }] = useApplicationContext();\n  const activeTimeframe = state === null || state === void 0 ? void 0 : state[TIME_KEY];\n  return [activeTimeframe, updateTimeframe];\n}\nexport function useStartTimestamp() {\n  const [activeWindow] = useTimeframe();\n  const [startDateTimestamp, setStartDateTimestamp] = useState(); // monitor the old date fetched\n\n  useEffect(() => {\n    let startTime = dayjs.utc().subtract(1, activeWindow === timeframeOptions.week ? 'week' : activeWindow === timeframeOptions.ALL_TIME ? 'year' : 'year').startOf('day').unix() - 1; // if we find a new start time less than the current startrtime - update oldest pooint to fetch\n\n    setStartDateTimestamp(startTime);\n  }, [activeWindow, startDateTimestamp]);\n  return startDateTimestamp;\n} // keep track of session length for refresh ticker\n\nexport function useSessionStart() {\n  const [state, {\n    updateSessionStart\n  }] = useApplicationContext();\n  const sessionStart = state === null || state === void 0 ? void 0 : state[SESSION_START];\n  useEffect(() => {\n    if (!sessionStart) {\n      updateSessionStart(Date.now());\n    }\n  });\n  const [seconds, setSeconds] = useState(0);\n  useEffect(() => {\n    let interval = null;\n    interval = setInterval(() => {\n      var _ref;\n\n      setSeconds((_ref = Date.now() - sessionStart) !== null && _ref !== void 0 ? _ref : Date.now());\n    }, 1000);\n    return () => clearInterval(interval);\n  }, [seconds, sessionStart]);\n  return parseInt(seconds / 1000);\n}\nexport function useListedTokens() {\n  const [state, {\n    updateSupportedTokens\n  }] = useApplicationContext();\n  const supportedTokens = state === null || state === void 0 ? void 0 : state[SUPPORTED_TOKENS];\n  useEffect(() => {\n    async function fetchList() {\n      const allFetched = await SUPPORTED_LIST_URLS__NO_ENS.reduce(async (fetchedTokens, url) => {\n        const tokensSoFar = await fetchedTokens;\n        const newTokens = await getTokenList(url);\n        return Promise.resolve([...tokensSoFar, ...newTokens.tokens]);\n      }, Promise.resolve([]));\n      let formatted = allFetched === null || allFetched === void 0 ? void 0 : allFetched.map(t => t.address.toLowerCase());\n      updateSupportedTokens(formatted);\n    }\n\n    if (!supportedTokens) {\n      fetchList();\n    }\n  }, [updateSupportedTokens, supportedTokens]);\n  return supportedTokens;\n}","map":{"version":3,"sources":["/Users/macbook/Desktop/Pega/pegaswap-docs/src/contexts/Application.js"],"names":["React","createContext","useContext","useReducer","useMemo","useCallback","useState","useEffect","timeframeOptions","SUPPORTED_LIST_URLS__NO_ENS","dayjs","utc","getTokenList","healthClient","SUBGRAPH_HEALTH","extend","UPDATE","UPDATE_TIMEFRAME","UPDATE_SESSION_START","UPDATED_SUPPORTED_TOKENS","UPDATE_LATEST_BLOCK","UPDATE_HEAD_BLOCK","SUPPORTED_TOKENS","TIME_KEY","CURRENCY","SESSION_START","LATEST_BLOCK","HEAD_BLOCK","ApplicationContext","useApplicationContext","reducer","state","type","payload","currency","newTimeFrame","timestamp","block","supportedTokens","Error","INITIAL_STATE","ALL_TIME","Provider","children","dispatch","update","updateTimeframe","updateSessionStart","updateSupportedTokens","updateLatestBlock","updateHeadBlock","useLatestBlocks","latestBlock","headBlock","fetch","query","then","res","syncedBlock","data","indexingStatusForCurrentVersion","chains","number","chainHeadBlock","catch","e","console","log","useCurrentCurrency","toggleCurrency","useTimeframe","activeTimeframe","useStartTimestamp","activeWindow","startDateTimestamp","setStartDateTimestamp","startTime","subtract","week","startOf","unix","useSessionStart","sessionStart","Date","now","seconds","setSeconds","interval","setInterval","clearInterval","parseInt","useListedTokens","fetchList","allFetched","reduce","fetchedTokens","url","tokensSoFar","newTokens","Promise","resolve","tokens","formatted","map","t","address","toLowerCase"],"mappings":"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","sourcesContent":["import React, { createContext, useContext, useReducer, useMemo, useCallback, useState, useEffect } from 'react'\nimport { timeframeOptions, SUPPORTED_LIST_URLS__NO_ENS } from '../constants'\nimport dayjs from 'dayjs'\nimport utc from 'dayjs/plugin/utc'\nimport getTokenList from '../utils/tokenLists'\nimport { healthClient } from '../apollo/client'\nimport { SUBGRAPH_HEALTH } from '../apollo/queries'\ndayjs.extend(utc)\n\nconst UPDATE = 'UPDATE'\nconst UPDATE_TIMEFRAME = 'UPDATE_TIMEFRAME'\nconst UPDATE_SESSION_START = 'UPDATE_SESSION_START'\nconst UPDATED_SUPPORTED_TOKENS = 'UPDATED_SUPPORTED_TOKENS'\nconst UPDATE_LATEST_BLOCK = 'UPDATE_LATEST_BLOCK'\nconst UPDATE_HEAD_BLOCK = 'UPDATE_HEAD_BLOCK'\n\nconst SUPPORTED_TOKENS = 'SUPPORTED_TOKENS'\nconst TIME_KEY = 'TIME_KEY'\nconst CURRENCY = 'CURRENCY'\nconst SESSION_START = 'SESSION_START'\nconst LATEST_BLOCK = 'LATEST_BLOCK'\nconst HEAD_BLOCK = 'HEAD_BLOCK'\n\nconst ApplicationContext = createContext()\n\nfunction useApplicationContext() {\n  return useContext(ApplicationContext)\n}\n\nfunction reducer(state, { type, payload }) {\n  switch (type) {\n    case UPDATE: {\n      const { currency } = payload\n      return {\n        ...state,\n        [CURRENCY]: currency,\n      }\n    }\n    case UPDATE_TIMEFRAME: {\n      const { newTimeFrame } = payload\n      return {\n        ...state,\n        [TIME_KEY]: newTimeFrame,\n      }\n    }\n    case UPDATE_SESSION_START: {\n      const { timestamp } = payload\n      return {\n        ...state,\n        [SESSION_START]: timestamp,\n      }\n    }\n\n    case UPDATE_LATEST_BLOCK: {\n      const { block } = payload\n      return {\n        ...state,\n        [LATEST_BLOCK]: block,\n      }\n    }\n\n    case UPDATE_HEAD_BLOCK: {\n      const { block } = payload\n      return {\n        ...state,\n        [HEAD_BLOCK]: block,\n      }\n    }\n\n    case UPDATED_SUPPORTED_TOKENS: {\n      const { supportedTokens } = payload\n      return {\n        ...state,\n        [SUPPORTED_TOKENS]: supportedTokens,\n      }\n    }\n\n    default: {\n      throw Error(`Unexpected action type in DataContext reducer: '${type}'.`)\n    }\n  }\n}\n\nconst INITIAL_STATE = {\n  CURRENCY: 'USD',\n  TIME_KEY: timeframeOptions.ALL_TIME,\n}\n\nexport default function Provider({ children }) {\n  const [state, dispatch] = useReducer(reducer, INITIAL_STATE)\n  const update = useCallback((currency) => {\n    dispatch({\n      type: UPDATE,\n      payload: {\n        currency,\n      },\n    })\n  }, [])\n\n  // global time window for charts - see timeframe options in constants\n  const updateTimeframe = useCallback((newTimeFrame) => {\n    dispatch({\n      type: UPDATE_TIMEFRAME,\n      payload: {\n        newTimeFrame,\n      },\n    })\n  }, [])\n\n  // used for refresh button\n  const updateSessionStart = useCallback((timestamp) => {\n    dispatch({\n      type: UPDATE_SESSION_START,\n      payload: {\n        timestamp,\n      },\n    })\n  }, [])\n\n  const updateSupportedTokens = useCallback((supportedTokens) => {\n    dispatch({\n      type: UPDATED_SUPPORTED_TOKENS,\n      payload: {\n        supportedTokens,\n      },\n    })\n  }, [])\n\n  const updateLatestBlock = useCallback((block) => {\n    dispatch({\n      type: UPDATE_LATEST_BLOCK,\n      payload: {\n        block,\n      },\n    })\n  }, [])\n\n  const updateHeadBlock = useCallback((block) => {\n    dispatch({\n      type: UPDATE_HEAD_BLOCK,\n      payload: {\n        block,\n      },\n    })\n  }, [])\n\n  return (\n    <ApplicationContext.Provider\n      value={useMemo(\n        () => [\n          state,\n          {\n            update,\n            updateSessionStart,\n            updateTimeframe,\n            updateSupportedTokens,\n            updateLatestBlock,\n            updateHeadBlock,\n          },\n        ],\n        [state, update, updateTimeframe, updateSessionStart, updateSupportedTokens, updateLatestBlock, updateHeadBlock]\n      )}\n    >\n      {children}\n    </ApplicationContext.Provider>\n  )\n}\n\nexport function useLatestBlocks() {\n  const [state, { updateLatestBlock, updateHeadBlock }] = useApplicationContext()\n\n  const latestBlock = state?.[LATEST_BLOCK]\n  const headBlock = state?.[HEAD_BLOCK]\n\n  useEffect(() => {\n    async function fetch() {\n      healthClient\n        .query({\n          query: SUBGRAPH_HEALTH,\n        })\n        .then((res) => {\n          const syncedBlock = res.data.indexingStatusForCurrentVersion.chains[0].latestBlock.number\n          const headBlock = res.data.indexingStatusForCurrentVersion.chains[0].chainHeadBlock.number\n          if (syncedBlock && headBlock) {\n            updateLatestBlock(syncedBlock)\n            updateHeadBlock(headBlock)\n          }\n        })\n        .catch((e) => {\n          console.log(e)\n        })\n    }\n    if (!latestBlock) {\n      fetch()\n    }\n  }, [latestBlock, updateHeadBlock, updateLatestBlock])\n\n  return [latestBlock, headBlock]\n}\n\nexport function useCurrentCurrency() {\n  const [state, { update }] = useApplicationContext()\n  const toggleCurrency = useCallback(() => {\n    if (state.currency === 'ETH') {\n      update('USD')\n    } else {\n      update('ETH')\n    }\n  }, [state, update])\n  return [state[CURRENCY], toggleCurrency]\n}\n\nexport function useTimeframe() {\n  const [state, { updateTimeframe }] = useApplicationContext()\n  const activeTimeframe = state?.[TIME_KEY]\n  return [activeTimeframe, updateTimeframe]\n}\n\nexport function useStartTimestamp() {\n  const [activeWindow] = useTimeframe()\n  const [startDateTimestamp, setStartDateTimestamp] = useState()\n\n  // monitor the old date fetched\n  useEffect(() => {\n    let startTime =\n      dayjs\n        .utc()\n        .subtract(\n          1,\n          activeWindow === timeframeOptions.week ? 'week' : activeWindow === timeframeOptions.ALL_TIME ? 'year' : 'year'\n        )\n        .startOf('day')\n        .unix() - 1\n    // if we find a new start time less than the current startrtime - update oldest pooint to fetch\n    setStartDateTimestamp(startTime)\n  }, [activeWindow, startDateTimestamp])\n\n  return startDateTimestamp\n}\n\n// keep track of session length for refresh ticker\nexport function useSessionStart() {\n  const [state, { updateSessionStart }] = useApplicationContext()\n  const sessionStart = state?.[SESSION_START]\n\n  useEffect(() => {\n    if (!sessionStart) {\n      updateSessionStart(Date.now())\n    }\n  })\n\n  const [seconds, setSeconds] = useState(0)\n\n  useEffect(() => {\n    let interval = null\n    interval = setInterval(() => {\n      setSeconds(Date.now() - sessionStart ?? Date.now())\n    }, 1000)\n\n    return () => clearInterval(interval)\n  }, [seconds, sessionStart])\n\n  return parseInt(seconds / 1000)\n}\n\nexport function useListedTokens() {\n  const [state, { updateSupportedTokens }] = useApplicationContext()\n  const supportedTokens = state?.[SUPPORTED_TOKENS]\n\n  useEffect(() => {\n    async function fetchList() {\n      const allFetched = await SUPPORTED_LIST_URLS__NO_ENS.reduce(async (fetchedTokens, url) => {\n        const tokensSoFar = await fetchedTokens\n        const newTokens = await getTokenList(url)\n        return Promise.resolve([...tokensSoFar, ...newTokens.tokens])\n      }, Promise.resolve([]))\n      let formatted = allFetched?.map((t) => t.address.toLowerCase())\n      updateSupportedTokens(formatted)\n    }\n    if (!supportedTokens) {\n      fetchList()\n    }\n  }, [updateSupportedTokens, supportedTokens])\n\n  return supportedTokens\n}\n"]},"metadata":{},"sourceType":"module"}